(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Suave=c.Suave||{};e=d.WebSocket=d.WebSocket||{};f=e.Test=e.Test||{};g=f.Client=f.Client||{};h=a.WebSharper$Community$Suave$WebSocket$Test_JsonDecoder=a.WebSharper$Community$Suave$WebSocket$Test_JsonDecoder||{};i=a.WebSharper$Community$Suave$WebSocket$Test_JsonEncoder=a.WebSharper$Community$Suave$WebSocket$Test_JsonEncoder||{};j=b&&b.UI;k=j&&j.Next;l=k&&k.Var;m=k&&k.Submitter;n=k&&k.View;o=b&&b.Remoting;p=o&&o.AjaxRemotingProvider;q=b&&b.Concurrency;r=k&&k.Doc;s=k&&k.AttrProxy;t=e&&e.Client;u=t&&t.WithEncoding;v=b&&b.Json;w=v&&v.Provider;g.Main=function(x){var y,z,A,B,C,D,E,F,G,H;g.WS(x);y=l.Create$1("");z=m.CreateOption(y.v);A=(B=z.view,n.MapAsync(function(I){var J;return(I!=null?I.$==1:false)?(J=I.$0,(new p.New()).Async("WebSharper.Community.Suave.WebSocket.Test:WebSharper.Community.Suave.WebSocket.Test.Server.DoSomething:-1287498065",[J])):q.Delay(function(){return q.Return("");});},B));C=[r.Input([],y),r.Button("Send",[],function(){z.Trigger();}),r.Element("hr",[],[]),(D=[s.Create("class","text-muted")],(E=[r.TextNode("The server responded:")],r.Element("h4",D,E))),(F=[s.Create("class","jumbotron")],(G=[(H=[r.TextView(A)],r.Element("h1",[],H))],r.Element("div",F,G)))];return r.Element("div",[],C);};g.WS=function(x){var y;y=q.Delay(function(){var z;z=u.ConnectStateful(function(A){return a.JSON.stringify((i.j())(A));},function(A){return(h.j())(a.JSON.parse(A));},x,function(){return q.Delay(function(){return q.Return([0,function(A){return function(B){return q.Delay(function(){var C,D,E,F,G;return B.$==3?(a.console.log("Connection closed."),q.Return(A)):B.$==2?(a.console.log("WebSocket connection open."),q.Return(A)):B.$==1?(a.console.log("WebSocket connection error!"),q.Return(A)):(C=B.$0,(D=C.$==0?(E=C.$0,(a.console.log.apply(a.console,[A].concat([E])),q.Return(null))):(F=C.$0,(a.console.log.apply(a.console,[A].concat([F])),q.Return(null))),(G=q.Delay(function(){return q.Return(A+1);}),q.Combine(D,G))));});};}]);});});return q.Bind(z,function(A){var B;B=q.Delay(function(){var C;C=q.Sleep(1000);return q.Bind(C,function(){var D;A.Post({$:0,$0:"HELLO"});D=q.Sleep(1000);return q.Bind(D,function(){A.Post({$:1,$0:123});return q.Return(null);});});});return q.While(function(){return true;},B);});});q.Start(y,null);};h.j=function(){return h._v?h._v:h._v=(w.DecodeUnion(void 0,"type",[["int",[["$0","value",w.Id(),0]]],["string",[["$0","value",w.Id(),0]]]]))();};i.j=function(){return i._v?i._v:i._v=(w.EncodeUnion(void 0,{"int":1,str:0},[["Request1",[["$0","str",w.Id(),0]]],["Request2",[["$0","int",w.Id(),0]]]]))();};}());
