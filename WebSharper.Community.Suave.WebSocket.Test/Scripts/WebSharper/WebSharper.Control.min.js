(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Control=b.Control||{};d=c.Observer=c.Observer||{};e=c.HotStream=c.HotStream||{};f=e.HotStream=e.HotStream||{};g=c.Observable=c.Observable||{};h=a.Microsoft=a.Microsoft||{};i=h.FSharp=h.FSharp||{};j=i.Control=i.Control||{};k=j.ObservableModule=j.ObservableModule||{};l=c.Event=c.Event||{};m=l.Event=l.Event||{};n=c.DelegateEvent=c.DelegateEvent||{};o=n.DelegateEvent=n.DelegateEvent||{};p=c.FSharpEvent=c.FSharpEvent||{};q=c.FSharpDelegateEvent=c.FSharpDelegateEvent||{};r=j.EventModule=j.EventModule||{};s=c.MailboxProcessor=c.MailboxProcessor||{};t=a.IntelliFactory;u=t&&t.Runtime;v=b&&b.Util;w=b&&b.List;x=b&&b.Ref;y=b&&b.Unchecked;z=b&&b.Seq;A=b&&b.Arrays;B=b&&b.Collections;C=B&&B.List;D=b&&b.Concurrency;E=b&&b.TimeoutException;F=b&&b.Operators;G=B&&B.LinkedList;d.New=function(H,I,J){return{OnCompleted:function(){return J();},OnError:I,OnNext:H};};d.Of=function(H){return{OnCompleted:function(){return null;},OnError:function(I){throw I;},OnNext:H};};f=e.HotStream=u.Class({Trigger:function(H){this.Latest[0]={$:1,$0:H};this.Event.event.Trigger(H);},Subscribe:function(H){this.Latest[0]!=null?H.OnNext(this.Latest[0].$0):void 0;return v.subscribeTo(this.Event.event,function(I){H.OnNext(I);});}},null,f);f.New$1=function(){return f.New([null],new p.New());};f.New=function(H,I){return new f({Latest:H,Event:I});};g.Sequence=function(H){function I(J){var K;return J.$==1?(K=I(J.$1),g.CombineLatest(J.$0,K,function(L,M){return new w.T({$:1,$0:L,$1:M});})):g.Return(new w.T({$:0}));}return I(w.ofSeq(H));};g.Aggregate=function(H,I,J){return{Subscribe:function(K){var L;L=[I];return H.Subscribe(d.New(function(M){g.Protect(function(){return J(L[0],M);},function(N){L[0]=N;K.OnNext(N);},function(N){K.OnError(N);});},function(M){K.OnError(M);},function(){K.OnCompleted();}));}};};g.SelectMany=function(H){return{Subscribe:function(I){var J,K,L;J=[function(){}];K=v.subscribeTo(H,function(M){var N;N=v.subscribeTo(M,function(O){I.OnNext(O);});J[0]=function(){J[0]();N.Dispose();};});L=function(){J[0]();K.Dispose();};return{Dispose:function(){return L();}};}};};g.Switch=function(H){return{Subscribe:function(I){var J,K;J=[0];K=[null];return v.subscribeTo(H,function(L){var M;x.incr(J);K[0]!=null?K[0].$0.Dispose():void 0;M=J[0];K[0]={$:1,$0:v.subscribeTo(L,function(N){if(M===J[0])I.OnNext(N);})};});}};};g.CombineLatest=function(H,I,J){return{Subscribe:function(K){var L,M,N,O,P,Q;L=[null];M=[null];N=function(){var R,S,T,U;R=L[0];S=M[0];(R!=null?R.$==1:false)?(S!=null?S.$==1:false)?(T=R.$0,U=S.$0,g.Protect(function(){return J(T,U);},function(V){K.OnNext(V);},function(V){K.OnError(V);})):void 0:void 0;};O=H.Subscribe(d.New(function(R){L[0]={$:1,$0:R};N();},function(R){},function(){}));P=I.Subscribe(d.New(function(R){M[0]={$:1,$0:R};N();},function(R){},function(){}));Q=function(){O.Dispose();P.Dispose();};return{Dispose:function(){return Q();}};}};};g.Range=function(H,I){return{Subscribe:function(J){var K,L,M;for(L=H,M=H+I;L<=M;L++)J.OnNext(L);K=function(){};return{Dispose:function(){return K();}};}};};g.Concat=function(H,I){return{Subscribe:function(J){var K,L,M;K=[null];L=H.Subscribe(d.New(function(N){J.OnNext(N);},function(N){},function(){K[0]={$:1,$0:I.Subscribe(J)};}));M=function(){K[0]!=null?K[0].$0.Dispose():void 0;L.Dispose();};return{Dispose:function(){return M();}};}};};g.Merge=function(H,I){return{Subscribe:function(J){var K,L,M,N,O;K=[false];L=[false];M=H.Subscribe(d.New(function(P){J.OnNext(P);},function(P){},function(){K[0]=true;(K[0]?L[0]:false)?J.OnCompleted():void 0;}));N=I.Subscribe(d.New(function(P){J.OnNext(P);},function(P){},function(){L[0]=true;(K[0]?L[0]:false)?J.OnCompleted():void 0;}));O=function(){M.Dispose();N.Dispose();};return{Dispose:function(){return O();}};}};};g.Drop=function(H,I){return{Subscribe:function(J){var K;K=[0];return I.Subscribe(d.New(function(L){x.incr(K);K[0]>H?J.OnNext(L):void 0;},function(L){J.OnError(L);},function(){J.OnCompleted();}));}};};g.Choose=function(H,I){return{Subscribe:function(J){return I.Subscribe(d.New(function(K){var L;g.Protect(function(){return H(K);},(L=function(M){J.OnNext(M);},function(M){if(M==null);else L(M.$0);}),function(M){J.OnError(M);});},function(K){J.OnError(K);},function(){J.OnCompleted();}));}};};g.Filter=function(H,I){return{Subscribe:function(J){return I.Subscribe(d.New(function(K){var L;g.Protect(function(){return H(K)?{$:1,$0:K}:null;},(L=function(M){J.OnNext(M);},function(M){if(M==null);else L(M.$0);}),function(M){J.OnError(M);});},function(K){J.OnError(K);},function(){J.OnCompleted();}));}};};g.Map=function(H,I){return{Subscribe:function(J){return I.Subscribe(d.New(function(K){g.Protect(function(){return H(K);},function(L){J.OnNext(L);},function(L){J.OnError(L);});},function(K){J.OnError(K);},function(){J.OnCompleted();}));}};};g.Protect=function(H,I,J){var K;try{K={$:0,$0:H()};}catch(L){K={$:1,$0:L};}return K.$==1?J(K.$0):I(K.$0);};g.Never=function(){return{Subscribe:function(){var H;H=function(){};return{Dispose:function(){return H();}};}};};g.Return=function(H){return{Subscribe:function(I){var J;I.OnNext(H);I.OnCompleted();J=function(){};return{Dispose:function(){return J();}};}};};g.Of=function(H){return{Subscribe:function(I){var J;J=H(function(K){I.OnNext(K);});return{Dispose:function(){return J();}};}};};k.Split=function(H,I){var J,K,L;J=(K=function(M){var N;N=H(M);return N.$==0?{$:1,$0:N.$0}:null;},function(M){return g.Choose(K,M);}(I));return[J,(L=function(M){var N;N=H(M);return N.$==1?{$:1,$0:N.$0}:null;},function(M){return g.Choose(L,M);}(I))];};k.Scan=function(H,I,J){return{Subscribe:function(K){var L;L=[I];return J.Subscribe(d.New(function(M){g.Protect(function(){return H(L[0],M);},function(N){L[0]=N;K.OnNext(N);},function(N){K.OnError(N);});},function(M){K.OnError(M);},function(){K.OnCompleted();}));}};};k.Partition=function(H,I){var J;return[g.Filter(H,I),g.Filter((J=function(K){return!K;},function(K){return J(H(K));}),I)];};k.Pairwise=function(H){return{Subscribe:function(I){var J;J=[null];return H.Subscribe(d.New(function(K){var L;L=J[0];(L!=null?L.$==1:false)?I.OnNext([L.$0,K]):void 0;J[0]={$:1,$0:K};},function(K){I.OnError(K);},function(){I.OnCompleted();}));}};};m=l.Event=u.Class({Subscribe$1:function(H){var I,J,K;I=this;J=function(L,M){return H.OnNext(M);};this.AddHandler$1(J);K=function(){I.RemoveHandler$1(J);};return{Dispose:function(){return K();}};},RemoveHandler$1:function(H){var I,J,K;I=(J=this.Handlers,function(L){J.RemoveAt(L);});(function(L){if(L==null);else I(L.$0);}((K=function(L){return y.Equals(H,L);},function(L){return z.tryFindIndex(K,L);}(this.Handlers))));},AddHandler$1:function(H){this.Handlers.Add(H);},Trigger:function(H){var I,J,K;I=this.Handlers.ToArray();for(J=0,K=I.length-1;J<=K;J++)(A.get(I,J))(null,H);},RemoveHandler:function(H){this.RemoveHandler$1(H);},AddHandler:function(H){this.AddHandler$1(H);},Subscribe:function(H){return this.Subscribe$1(H);},Dispose:function(){}},null,m);m.New=function(H){return new m({Handlers:H});};o=n.DelegateEvent=u.Class({RemoveHandler$1:function(H){var I,J,K;I=(J=this.Handlers,function(L){J.RemoveAt(L);});(function(L){if(L==null);else I(L.$0);}((K=function(L){return y.Equals(H,L);},function(L){return z.tryFindIndex(K,L);}(this.Handlers))));},AddHandler$1:function(H){this.Handlers.Add(H);},Trigger:function(H){var I,J,K,L;I=this.Handlers.ToArray();for(J=0,K=I.length-1;J<=K;J++){L=A.get(I,J).apply(null,H);}},RemoveHandler:function(H){this.RemoveHandler$1(H);},AddHandler:function(H){this.AddHandler$1(H);},Dispose:function(){}},null,o);o.New=function(H){return new o({Handlers:H});};p=c.FSharpEvent=u.Class({},null,p);p.New=u.Ctor(function(){this.event=m.New(new C.New$2());},p);q=c.FSharpDelegateEvent=u.Class({},null,q);q.New=u.Ctor(function(){this.event=o.New(new C.New$2());},q);r.Split=function(H,I){var J,K;return[(J=function(L){var M;M=H(L);return M.$==0?{$:1,$0:M.$0}:null;},function(L){return r.Choose(J,L);}(I)),(K=function(L){var M;M=H(L);return M.$==1?{$:1,$0:M.$0}:null;},function(L){return r.Choose(K,L);}(I))];};r.Scan=function(H,I,J){var K;K=[I];return r.Map(function(L){K[0]=H(K[0],L);return K[0];},J);};r.Partition=function(H,I){var J;return[r.Filter(H,I),r.Filter((J=function(K){return!K;},function(K){return J(H(K));}),I)];};r.Pairwise=function(H){var I,J;I=[null];J=m.New(new C.New$2());v.addListener(H,function(K){var L;L=I[0];(L!=null?L.$==1:false)?(I[0]={$:1,$0:K},J.Trigger([L.$0,K])):I[0]={$:1,$0:K};});return J;};r.Merge=function(H,I){var J;J=m.New(new C.New$2());v.addListener(H,function(K){J.Trigger(K);});v.addListener(I,function(K){J.Trigger(K);});return J;};r.Map=function(H,I){var J;J=m.New(new C.New$2());v.addListener(I,function(K){J.Trigger(H(K));});return J;};r.Filter=function(H,I){var J;J=m.New(new C.New$2());v.addListener(I,function(K){if(H(K))J.Trigger(K);});return J;};r.Choose=function(H,I){var J;J=new p.New();v.addListener(I,function(K){var L;L=H(K);L==null?void 0:J.event.Trigger(L.$0);});return J.event;};s=c.MailboxProcessor=u.Class({dequeue:function(){var H;H=this.mailbox.n.v;this.mailbox.RemoveFirst();return H;},resume:function(){var H;H=this.savedCont;(H!=null?H.$==1:false)?(this.savedCont=null,this.startAsync(H.$0)):void 0;},startAsync:function(H){D.Start(H,this.token);},Scan:function(H,I){var J;J=this;return D.Delay(function(){var K;K=J.TryScan(H,I);return D.Bind(K,function(L){var M;if(L!=null?L.$==1:false)M=L.$0;else throw new E.New();return D.Return(M);});});},TryScan:function(H,I){var J,K;J=this;K=F.DefaultArg(I,this.get_DefaultTimeout());return D.Delay(function(){var L,M,N,O,P;M=J.mailbox.n;N=null;while(!y.Equals(M,null)){P=H(M.v);P==null?M=M.n:(J.mailbox.Remove$1(M),M=null,N=P);}L=N;return(L!=null?L.$==1:false)?D.Bind(L.$0,function(Q){return D.Return({$:1,$0:Q});}):(O=function(Q){var S,T;if(K<0){function R(){J.savedCont={$:1,$0:D.Delay(function(){var V;V=H(J.mailbox.n.v);return(V!=null?V.$==1:false)?(J.mailbox.RemoveFirst(),D.Bind(V.$0,function(W){Q({$:1,$0:W});return D.Return(null);})):(R(),D.Return(null));})};}R();}else{function U(){J.savedCont={$:1,$0:D.Delay(function(){var V;V=H(J.mailbox.n.v);return(V!=null?V.$==1:false)?(J.mailbox.RemoveFirst(),D.Bind(V.$0,function(W){return S[0]?(S[0]=false,a.clearTimeout(T),Q({$:1,$0:W}),D.Return(null)):D.Return(null);})):(U(),D.Return(null));})};}S=[true];T=a.setTimeout(function(){if(S[0]){S[0]=false;J.savedCont=null;Q(null);}},K);U();}},D.FromContinuations(function(Q,R,S){return O.apply(null,[Q,R,S]);}));});},PostAndAsyncReply:function(H,I){var J;J=this;return D.Delay(function(){var K;K=J.PostAndTryAsyncReply(H,I);return D.Bind(K,function(L){var M;if(L!=null?L.$==1:false)M=L.$0;else throw new E.New();return D.Return(M);});});},PostAndTryAsyncReply:function(H,I){var J,K,L;J=this;K=F.DefaultArg(I,this.get_DefaultTimeout());L=function(M){var N,O,P,Q,R;if(K<0){O=J.mailbox.AddLast(H((N=function(S){return{$:1,$0:S};},function(S){return M(N(S));})));J.resume();}else{P=[true];Q=J.mailbox.AddLast(H(function(S){if(P[0]){P[0]=false;M({$:1,$0:S});}}));J.resume();R=a.setTimeout(function(){if(P[0]){P[0]=false;M(null);}},K);}};return D.FromContinuations(function(M,N,O){return L.apply(null,[M,N,O]);});},get_CurrentQueueLength:function(){return this.mailbox.c;},Receive:function(H){var I;I=this;return D.Delay(function(){var J;J=I.TryReceive(H);return D.Bind(J,function(K){var L;if(K!=null?K.$==1:false)L=K.$0;else throw new E.New();return D.Return(L);});});},TryReceive:function(H){var I,J,K;I=this;J=F.DefaultArg(H,this.get_DefaultTimeout());K=function(L){var M,N;if(y.Equals(I.mailbox.n,null)){if(J<0)I.savedCont={$:1,$0:D.Delay(function(){L({$:1,$0:I.dequeue()});return D.Return(null);})};else{M=[true];N=a.setTimeout(function(){if(M[0]){M[0]=false;I.savedCont=null;L(null);}},J);I.savedCont={$:1,$0:D.Delay(function(){return M[0]?(M[0]=false,a.clearTimeout(N),L({$:1,$0:I.dequeue()}),D.Return(null)):D.Return(null);})};}}else L({$:1,$0:I.dequeue()});};return D.FromContinuations(function(L,M,N){return K.apply(null,[L,M,N]);});},Start:function(){var H;H=this;this.started?F.FailWith("The MailboxProcessor has already been started."):(this.started=true,H.startAsync(D.Delay(function(){var I;I=D.Delay(function(){var J;J=H.initial(H);return D.Bind(J,function(){return D.Return(null);});});return D.TryWith(I,function(J){H.errorEvent.event.Trigger(J);return D.Return(null);});})));},set_DefaultTimeout:function(H){this.DefaultTimeout=H;},get_DefaultTimeout:function(){return this.DefaultTimeout;},remove_Error:function(H){this.errorEvent.event.RemoveHandler(H);},add_Error:function(H){this.errorEvent.event.AddHandler(H);},get_Error:function(){return this.errorEvent.event;}},null,s);s.Start=function(H,I){var J;J=new s.New(H,I);J.Start();return J;};s.New=u.Ctor(function(H,I){var J,K,L,M;J=this;this.initial=H;this.token=I;this.started=false;this.errorEvent=new p.New();this.mailbox=new G.New();this.savedCont=null;K=this.token;K==null?void 0:L=(M=function(){return J.resume();},D.Register(K.$0,function(){M();}));this.DefaultTimeout=-1;},s);}());
