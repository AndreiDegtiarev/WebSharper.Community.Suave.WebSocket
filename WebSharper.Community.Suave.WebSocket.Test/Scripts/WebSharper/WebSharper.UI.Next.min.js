(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ;a=window;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Next=c.Next||{};e=d.Array=d.Array||{};f=d.String=d.String||{};g=d.Abbrev=d.Abbrev||{};h=g.Fresh=g.Fresh||{};i=g.HashSet=g.HashSet||{};j=g.Dict=g.Dict||{};k=g.Slot=g.Slot||{};l=g.Async=g.Async||{};m=g.Mailbox=g.Mailbox||{};n=m.MailboxState=m.MailboxState||{};o=a.StartupCode$WebSharper_UI_Next$Abbrev=a.StartupCode$WebSharper_UI_Next$Abbrev||{};p=d.AppendList=d.AppendList||{};q=a.StartupCode$WebSharper_UI_Next$AppendList=a.StartupCode$WebSharper_UI_Next$AppendList||{};r=d.DomUtility=d.DomUtility||{};s=a.StartupCode$WebSharper_UI_Next$DomUtility=a.StartupCode$WebSharper_UI_Next$DomUtility||{};t=d.Trie=d.Trie||{};u=a.StartupCode$WebSharper_UI_Next$Trie=a.StartupCode$WebSharper_UI_Next$Trie||{};v=d.Snap=d.Snap||{};w=d.Var=d.Var||{};x=d.View=d.View||{};y=d.Submitter=d.Submitter||{};z=d.Key=d.Key||{};A=d.Model=d.Model||{};B=d.Serializer=d.Serializer||{};C=d.Storage=d.Storage||{};D=C.ArrayStorage=C.ArrayStorage||{};E=C.LocalStorageBackend=C.LocalStorageBackend||{};F=d.ListModel=d.ListModel||{};G=d.ListModels=d.ListModels||{};H=a.StartupCode$WebSharper_UI_Next$Models=a.StartupCode$WebSharper_UI_Next$Models||{};I=d.ReactiveExtensions=d.ReactiveExtensions||{};J=d.DoubleInterpolation=d.DoubleInterpolation||{};K=d.Interpolation=d.Interpolation||{};L=d.Easing=d.Easing||{};M=d.Easings=d.Easings||{};N=d.An=d.An||{};O=d.Anims=d.Anims||{};P=d.Trans=d.Trans||{};Q=a.StartupCode$WebSharper_UI_Next$Animation=a.StartupCode$WebSharper_UI_Next$Animation||{};R=d.AnimatedAttrNode=d.AnimatedAttrNode||{};S=d.DynamicAttrNode=d.DynamicAttrNode||{};T=d.AttrProxy=d.AttrProxy||{};U=d.Client=d.Client||{};V=U.Attrs=U.Attrs||{};W=V.Dyn=V.Dyn||{};X=d.Attrs=d.Attrs||{};Y=d.CheckedInput=d.CheckedInput||{};Z=d.AttrModule=d.AttrModule||{};_0=a.StartupCode$WebSharper_UI_Next$Attr_Client=a.StartupCode$WebSharper_UI_Next$Attr_Client||{};_1=d.DocElemNode=d.DocElemNode||{};_2=U.Docs=U.Docs||{};_3=_2.DomNodes=_2.DomNodes||{};_4=_2.NodeSet=_2.NodeSet||{};_5=_2.RunState=_2.RunState||{};_6=d.Docs=d.Docs||{};_7=d.Doc=d.Doc||{};_8=d.Elt=d.Elt||{};_9=U.EltUpdater=U.EltUpdater||{};_=a.StartupCode$WebSharper_UI_Next$Doc_Client=a.StartupCode$WebSharper_UI_Next$Doc_Client||{};$=d.Flow=d.Flow||{};ba=d.FlowBuilder=d.FlowBuilder||{};bb=d.Html=d.Html||{};bc=bb.attr=bb.attr||{};bd=d.Route=d.Route||{};be=d.Routing=d.Routing||{};bf=be.State=be.State||{};bg=d.RouteMap=d.RouteMap||{};bh=d.Router=d.Router||{};bi=d.Input=d.Input||{};bj=bi.MousePosSt=bi.MousePosSt||{};bk=bi.MouseBtnSt=bi.MouseBtnSt||{};bl=bi.Mouse=bi.Mouse||{};bm=bi.KeyListenerSt=bi.KeyListenerSt||{};bn=bi.Keyboard=bi.Keyboard||{};bo=a.StartupCode$WebSharper_UI_Next$Input=a.StartupCode$WebSharper_UI_Next$Input||{};bp=b&&b.List;bq=b&&b.Arrays;br=b&&b.Enumerator;bs=b&&b.Strings;bt=b&&b.Char;bu=b&&b.Collections;bv=bu&&bu.HashSet;bw=b&&b.Seq;bx=a.IntelliFactory;by=bx&&bx.Runtime;bz=b&&b.Unchecked;bA=b&&b.Concurrency;bB=bu&&bu.Map;bC=bu&&bu.FSharpMap;bD=bu&&bu.List;bE=b&&b.Operators;bF=b&&b.Ref;bG=b&&b.Lazy;bH=bu&&bu.Dictionary;bI=b&&b.Int32;bJ=b&&b.Slice;e.mapInPlace=function(bK,bL){var bM,bN;for(bM=0,bN=bL.length-1;bM<=bN;bM++)bL[bM]=bK(bL[bM]);return bL;};e.ofSeqNonCopying=function(bK){var bL,bM,bN;if(bK instanceof a.Array)return bK;else if(bK instanceof bp.T)return bq.ofList(bK);else if(bK===null)return[];else{bL=[];bM=br.Get(bK);try{while(bM.MoveNext()){bN=bL.push(bM.Current());}return bL;}finally{if("Dispose"in bM)bM.Dispose();}}};e.MapTreeReduce=function(bK,bL,bM,bN){var bO;function bP(bQ,bR){var bS,bT;return bR<=0?bL:(bR===1?(bQ>=0?bQ<bO:false)?true:false:false)?bK(bq.get(bN,bQ)):(bT=bR/2>>0,bM(bP(bQ,bT),bP(bQ+bT,bR-bT)));}bO=bq.length(bN);return bP(0,bO);};e.TreeReduce=function(bK,bL,bM){var bN;function bO(bP,bQ){var bR,bS;return bQ<=0?bK:(bQ===1?(bP>=0?bP<bN:false)?true:false:false)?bq.get(bM,bP):(bS=bQ/2>>0,bL(bO(bP,bS),bO(bP+bS,bQ-bS)));}bN=bq.length(bM);return bO(0,bN);};f.isBlank=function(bK){return bs.forall(bt.IsWhiteSpace,bK);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){o.$cctor();return o.counter;};h.set_counter=function(bK){o.$cctor();o.counter=bK;};i.Filter=function(bK,bL){var bM;return new bv.New$2((bM=i.ToArray(bL),bq.filter(bK,bM)));};i.Intersect=function(bK,bL){var bM;bM=new bv.New$2(i.ToArray(bK));bM.IntersectWith(i.ToArray(bL));return bM;};i.Except=function(bK,bL){var bM;bM=new bv.New$2(i.ToArray(bL));bM.ExceptWith(i.ToArray(bK));return bM;};i.ToArray=function(bK){var bL;bL=bq.create(bK.get_Count(),void 0);bK.CopyTo(bL);return bL;};j.ToValueArray=function(bK){var bL,bM;bL=bq.create(bK.count,void 0);bM=function(bN,bO){return bq.set(bL,bN,bO.V);};(function(bN){bw.iteri(bM,bN);}(bK));return bL;};j.ToKeyArray=function(bK){var bL,bM;bL=bq.create(bK.count,void 0);bM=function(bN,bO){return bq.set(bL,bN,bO.K);};(function(bN){bw.iteri(bM,bN);}(bK));return bL;};k=g.Slot=by.Class({GetHashCode:function(){return bz.Hash(this.key(this.value));},Equals:function(bK){return bz.Equals(this.key(this.value),this.key(bK.get_Value()));},get_Value:function(){return this.value;}},null,k);k.New=by.Ctor(function(bK,bL){this.key=bK;this.value=bL;},k);k.Create=function(bK,bL){return new k.New(bK,bL);};l.OnError=function(bK){return a.console.log("WebSharper UI.Next: Uncaught asynchronous exception",bK);};l.Schedule=function(bK){var bL;bL=bA.Delay(function(){bK();return bA.Return(null);});bA.Start(bL,null);};l.StartTo=function(bK,bL){bA.StartWithContinuations(bK,bL,function(bM){l.OnError(bM);},function(bM){},null);};n=m.MailboxState=by.Class({},null,n);m.StartProcessor=function(bK){var bL;function bM(){return bA.Delay(function(){return bA.Bind(bK,function(){var bN,bO;bN=bL[0];return bz.Equals(bN,1)?(bL[0]=0,bA.Return(null)):bz.Equals(bN,2)?(bL[0]=1,bO=bM(),bA.Bind(bO,function(){return bA.Return(null);})):bA.Return(null);});});}bL=[0];return function(){var bN,bO;bN=bL[0];bz.Equals(bN,0)?(bL[0]=1,bO=bM(),bA.Start(bO,null)):bz.Equals(bN,1)?bL[0]=2:void 0;};};o.$cctor=by.Cctor(function(){o.counter=0;o.$cctor=a.ignore;});p.FromArray=function(bK){var bL;bL=bK.length;return bL===0?{$:0}:bL===1?{$:1,$0:bq.get(bK,0)}:{$:3,$0:bK.slice()};};p.ToArray=function(bK){var bL;function bM(bN){var bO,bP;if(bN.$==1)bL.push(bN.$0);else if(bN.$==2){bO=bN.$1;bM(bN.$0);bM(bO);}else if(bN.$==3){bP=bN.$0;bq.iter(function(bQ){bL.push(bQ);},bP);}}bL=[];bM(bK);return bL.slice(0);};p.Single=function(bK){return{$:1,$0:bK};};p.Concat=function(bK){var bL,bM;bL=e.ofSeqNonCopying(bK);bM=p.Empty();return e.TreeReduce(bM,p.Append,bL);};p.Append=function(bK,bL){return bK.$==0?bL:bL.$==0?bK:{$:2,$0:bK,$1:bL};};p.Empty=function(){q.$cctor();return q.Empty;};q.$cctor=by.Cctor(function(){q.Empty={$:0};q.$cctor=a.ignore;});r.SetProperty=function(bK,bL,bM){return bK.setProperty(bL,bM);};r.IterSelector=function(bK,bL,bM){var bN,bO,bP;bN=bK.querySelectorAll(bL);for(bO=0,bP=bN.length-1;bO<=bP;bO++)bM(bN[bO]);};r.ChildrenArray=function(bK){var bL,bM,bN,bO;bL=[];for(bM=0,bN=bK.childNodes.length-1;bM<=bN;bM++){bO=bL.push(bK.childNodes[bM]);}return bL;};r.RemoveClass=function(bK,bL){var bM;bM=a.jQuery(bK).removeClass(bL);};r.AddClass=function(bK,bL){var bM;bM=a.jQuery(bK).addClass(bL);};r.InsertAt=function(bK,bL,bM){var bN,bO;!(bM.parentNode===bK?bL===(bN=bM.nextSibling,bz.Equals(bN,null)?null:bN):false)?bO=bK.insertBefore(bM,bL):void 0;};r.RemoveNode=function(bK,bL){var bM;if(bL.parentNode===bK){bM=bK.removeChild(bL);}};r.SetStyle=function(bK,bL,bM){r.SetProperty(bK.style,bL,bM);};r.SetAttr=function(bK,bL,bM){bK.setAttribute(bL,bM);};r.RemoveAttr=function(bK,bL){bK.removeAttribute(bL);};r.CreateAttr=function(bK,bL){var bM;bM=r.Doc().createAttribute(bK);bM.value=bL;return bM;};r.CreateText=function(bK){return r.Doc().createTextNode(bK);};r.CreateSvgElement=function(bK){return r.Doc().createElementNS("http://www.w3.org/2000/svg",bK);};r.CreateElement=function(bK){return r.Doc().createElement(bK);};r.Clear=function(bK){var bL;while(bK.hasChildNodes()){bL=bK.removeChild(bK.firstChild);}};r.ClearAttrs=function(bK){var bL;while(bK.hasAttributes()){bL=bK.removeAttributeNode(bK.attributes.item(0));}};r.AppendTo=function(bK,bL){var bM;bM=bK.appendChild(bL);};r.Doc=function(){s.$cctor();return s.Doc;};s.$cctor=by.Cctor(function(){s.Doc=a.document;s.$cctor=a.ignore;});t.Empty=function(){u.$cctor();return u.Empty;};t.Lookup=function(bK,bL){return t.Look(bp.ofSeq(bL),bK);};t.Look=function(bK,bL){var bM,bN,bO,bP,bQ,bR;switch(bL.$==2?(bM=bL.$0,0):bL.$==0?bK.$==1?(bM=[bK.$0,bK.$1,bL.$0],1):2:2){case 0:return{$:0,$0:bM,$1:bK};break;case 1:bN=bM[0];bO=bM[1];bP=bM[2];bQ=bB.TryFind(bN,bP);return bQ==null?{$:1}:(bR=bQ.$0,t.Look(bO,bR));break;case 2:return{$:1};break;}};t.ToArray=function(bK){var bL,bM;bL=[];bM=t.Map(function(){return function(bN){return bL.push(bN);};},bK);return bL.slice(0);};t.Mapi=function(bK,bL){var bM,bN;bM=[0];bN=function(){var bO;bO=bM[0];bM[0]=bO+1;return bO;};return t.Map(function(bO){return bK(bN(),bO);},bL);};t.Map=function(bK,bL){return t.MapLoop(new bp.T({$:0}),bK,bL);};t.MapLoop=function(bK,bL,bM){var bN,bO,bP;return bM.$==1?{$:1}:bM.$==2?(bN=bM.$0,{$:2,$0:(bL(bK))(bN)}):(bO=bM.$0,t.TrieBranch((bP=function(bQ,bR){return t.MapLoop(bp.append(bK,bp.ofArray([bQ])),bL,bR);},function(bQ){return bB.Map(bP,bQ);}(bO))));};t.Merge=function(bK){var bL,bM,bN,bO,bP,bQ;bL=e.ofSeqNonCopying(bK);bM=bq.length(bL);return bM===0?{$:1,$0:{$:1}}:bM===1?{$:1,$0:bq.get(bL,0)}:bq.exists(t.IsLeaf,bL)?null:(bN=(bO=(bP=function(bR){return bR.$==0?{$:1,$0:bR.$0}:null;},function(bR){return bw.choose(bP,bR);}(bL)),t.MergeMaps(t.Merge,bO)),bN==null?null:(bQ=bN.$0,{$:1,$0:t.TrieBranch(bQ)}));};t.IsLeaf=function(bK){return bK.$==2?true:false;};t.MergeMaps=function(bK,bL){var bM,bN,bO,bP;bM=function(bQ){return bB.OfArray(bq.ofSeq(bQ));};return function(bQ){return bQ==null?null:{$:1,$0:bM(bQ.$0)};}(t.AllSome((bN=function(bQ,bR){var bS;bS=function(bT){return[bQ,bT];};return function(bT){return bT==null?null:{$:1,$0:bS(bT.$0)};}(bK(bR));},function(bQ){return bw.map(function(bR){return bN(bR[0],bR[1]);},bQ);}(bB.ToSeq((bO=bw.collect(bB.ToSeq,bL),(bP=new bC.New([]),bw.fold(function(bQ,bR){var bS,bT;bS=bR[0];bT=bR[1];return t.MultiAdd(bS,bT,bQ);},bP,bO))))))));};t.AllSome=function(bK){var bL,bM,bN,bO;bM=br.Get(bK);bN=new bD.New$2();bL=true;while(bL?bM.MoveNext():false){bO=bM.Current();(bO!=null?bO.$==1:false)?bN.Add(bO.$0):bL=false;}return bL?{$:1,$0:bN.ToArray()}:null;};t.MultiAdd=function(bK,bL,bM){return bM.Add(bK,new bp.T({$:1,$0:bL,$1:t.MultiFind(bK,bM)}));};t.MultiFind=function(bK,bL){return bE.DefaultArg(bB.TryFind(bK,bL),new bp.T({$:0}));};t.Prefix=function(bK,bL){return t.TrieBranch(new bC.New(bp.ofArray([[bK,bL]])));};t.Leaf=function(bK){return{$:2,$0:bK};};t.TrieBranch=function(bK){return bK.get_IsEmpty()?{$:1}:{$:0,$0:bK};};u.$cctor=by.Cctor(function(){u.Empty={$:1};u.$cctor=a.ignore;});v.MapAsync=function(bK,bL){var bM;bM=v.Create();v.When(bL,function(bN){l.StartTo(bK(bN),function(bO){v.MarkDone(bM,bL,bO);});},v.Obs(bM));return bM;};v.SnapshotOn=function(bK,bL){var bM,bN;function bO(bP){var bQ,bR,bS,bT,bU;if(!v.IsDone(bM)){bQ=v.ValueAndForever(bK);bR=v.ValueAndForever(bL);(bQ!=null?bQ.$==1:false)?(bR!=null?bR.$==1:false)?(bS=bQ.$0[1],bT=bR.$0[1],bU=bR.$0[0],(bS?true:bT)?v.MarkForever(bM,bU):v.MarkReady(bM,bU)):void 0:void 0;}}bM=v.Create();bN=v.Obs(bM);v.When(bK,bO,bN);v.When(bL,bO,function(){});return bM;};v.Map3=function(bK,bL,bM,bN){var bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4;function b5(b6){var b7,b8,b9,b_,b$,ca,cb,cc,cd;if(!v.IsDone(b3)){b7=v.ValueAndForever(bL);b8=v.ValueAndForever(bM);b9=v.ValueAndForever(bN);(b7!=null?b7.$==1:false)?(b8!=null?b8.$==1:false)?(b9!=null?b9.$==1:false)?(b_=b7.$0[1],b$=b8.$0[1],ca=b9.$0[1],cb=b7.$0[0],cc=b8.$0[0],cd=b9.$0[0],((b_?b$:false)?ca:false)?v.MarkForever(b3,bK(cb,cc,cd)):v.MarkReady(b3,bK(cb,cc,cd))):void 0:void 0:void 0;}}bO=bL.s;bP=bM.s;bQ=bN.s;return bO.$==0?bP.$==0?bQ.$==0?(bR=bO.$0,(bS=bP.$0,(bT=bQ.$0,v.CreateForever(bK(bR,bS,bT))))):(bU=bO.$0,(bV=bP.$0,v.Map(function(b6){return bK(bU,bV,b6);},bN))):bQ.$==0?(bW=bO.$0,(bX=bQ.$0,v.Map(function(b6){return bK(bW,b6,bX);},bM))):(bY=bO.$0,v.Map2(function(b6,b7){return bK(bY,b6,b7);},bM,bN)):bP.$==0?bQ.$==0?(bZ=bP.$0,(b0=bQ.$0,v.Map(function(b6){return bK(b6,bZ,b0);},bL))):(b1=bP.$0,v.Map2(function(b6,b7){return bK(b6,b1,b7);},bL,bN)):bQ.$==0?(b2=bQ.$0,v.Map2(function(b6,b7){return bK(b6,b7,b2);},bL,bM)):(b3=v.Create(),(b4=v.Obs(b3),(v.When(bL,b5,b4),v.When(bM,b5,b4),v.When(bN,b5,b4),b3)));};v.Map2Unit=function(bK,bL){var bM,bN,bO,bP;function bQ(){var bR,bS,bT,bU;if(!v.IsDone(bO)){bR=v.ValueAndForever(bK);bS=v.ValueAndForever(bL);(bR!=null?bR.$==1:false)?(bS!=null?bS.$==1:false)?(bT=bR.$0[1],bU=bS.$0[1],(bT?bU:false)?v.MarkForever(bO,null):v.MarkReady(bO,null)):void 0:void 0;}}bM=bK.s;bN=bL.s;return bM.$==0?bN.$==0?v.CreateForever():bL:bN.$==0?bK:(bO=v.Create(),(bP=v.Obs(bO),(v.When(bK,bQ,bP),v.When(bL,bQ,bP),bO)));};v.Map2=function(bK,bL,bM){var bN,bO,bP,bQ,bR,bS,bT,bU;function bV(bW){var bX,bY,bZ,b0,b1,b2;if(!v.IsDone(bT)){bX=v.ValueAndForever(bL);bY=v.ValueAndForever(bM);(bX!=null?bX.$==1:false)?(bY!=null?bY.$==1:false)?(bZ=bX.$0[1],b0=bY.$0[1],b1=bX.$0[0],b2=bY.$0[0],(bZ?b0:false)?v.MarkForever(bT,bK(b1,b2)):v.MarkReady(bT,bK(b1,b2))):void 0:void 0;}}bN=bL.s;bO=bM.s;return bN.$==0?bO.$==0?(bP=bN.$0,(bQ=bO.$0,v.CreateForever(bK(bP,bQ)))):(bR=bN.$0,v.Map(function(bW){return bK(bR,bW);},bM)):bO.$==0?(bS=bO.$0,v.Map(function(bW){return bK(bW,bS);},bL)):(bT=v.Create(),(bU=v.Obs(bT),(v.When(bL,bV,bU),v.When(bM,bV,bU),bT)));};v.MapCachedBy=function(bK,bL,bM,bN){return v.Map(function(bO){var bP,bQ,bR;bP=bL[0];return((bP!=null?bP.$==1:false)?bK(bO,bP.$0[0])?(bQ=[bP.$0[0],bP.$0[1]],true):false:false)?bQ[1]:(bR=bM(bO),(bL[0]={$:1,$0:[bO,bR]},bR));},bN);};v.Map=function(bK,bL){var bM,bN,bO,bP;bM=bL.s;return bM.$==0?(bN=bM.$0,v.CreateForever(bK(bN))):(bO=v.Create(),(v.When(bL,(bP=function(bQ){v.MarkDone(bO,bL,bQ);},function(bQ){return bP(bK(bQ));}),v.Obs(bO)),bO));};v.Sequence=function(bK){var bL,bM,bN,bO,bP,bQ;bL=bq.ofSeq(bK);return bL.length==0?v.CreateForever([]):(bM=v.Create(),(bN=[bq.length(bL)-1],(bO=v.Obs(bM),(bP=function(){var bR,bS;if(bN[0]===0){bR=(bS=function(bT){var bU;bU=bT.s;return bU.$==0?bU.$0:bU.$==2?bU.$0:bE.FailWith("value not found by View.Sequence");},function(bT){return bq.map(bS,bT);}(bL));bq.forall(v.IsForever,bL)?v.MarkForever(bM,bR):v.MarkReady(bM,bR);}else bF.decr(bN);},(bQ=function(bR){v.When(bR,bP,bO);},function(bR){bq.iter(bQ,bR);}(bL),bM)))));};v.CreateForeverAsync=function(bK){var bL;bL=v.Make({$:3,$0:[],$1:[]});l.StartTo(bK,function(bM){v.MarkForever(bL,bM);});return bL;};v.JoinInner=function(bK){var bL,bM;bL=v.Create();bM=v.Obs(bL);v.When(bK,function(bN){var bO;bO=bN();v.When(bO,function(bP){if(v.IsForever(bO)?v.IsForever(bK):false)v.MarkForever(bL,bP);else v.MarkReady(bL,bP);},bM);v.WhenObsolete(bK,v.Obs(bO));},bM);return bL;};v.Join=function(bK){var bL,bM;bL=v.Create();bM=v.Obs(bL);v.When(bK,function(bN){var bO;bO=bN();v.When(bO,function(bP){if(v.IsForever(bO)?v.IsForever(bK):false)v.MarkForever(bL,bP);else v.MarkReady(bL,bP);},bM);},bM);return bL;};v.ValueAndForever=function(bK){var bL;bL=bK.s;return bL.$==0?{$:1,$0:[bL.$0,true]}:bL.$==2?{$:1,$0:[bL.$0,false]}:null;};v.WhenObsolete=function(bK,bL){var bM;bM=bK.s;bM.$==1?bL():bM.$==2?bM.$1.push(bL):bM.$==3?bM.$1.push(bL):void 0;};v.When=function(bK,bL,bM){var bN,bO,bP;bN=bK.s;bN.$==1?bM():bN.$==2?(bO=bN.$0,bN.$1.push(bM),bL(bO)):bN.$==3?(bP=bN.$1,bN.$0.push(bL),bP.push(bM)):bL(bN.$0);};v.MarkDone=function(bK,bL,bM){if(v.IsForever(bL))v.MarkForever(bK,bM);else v.MarkReady(bK,bM);};v.MarkReady=function(bK,bL){var bM,bN,bO;bM=bK.s;bM.$==3?(bN=bM.$1,bO=bM.$0,bK.s={$:2,$0:bL,$1:bN},bw.iter(function(bP){bP(bL);},bO)):void 0;};v.Obs=function(bK){return function(){v.MarkObsolete(bK);};};v.MarkObsolete=function(bK){var bL,bM;bL=bK.s;(bL.$==1?true:bL.$==2?(bM=bL.$1,false):bL.$==3?(bM=bL.$1,false):true)?void 0:(bK.s={$:1},bw.iter(function(bN){bN();},bM));};v.MarkForever=function(bK,bL){var bM,bN;bM=bK.s;bM.$==3?(bN=bM.$0,bK.s={$:0,$0:bL},bw.iter(function(bO){bO(bL);},bN)):void 0;};v.IsDone=function(bK){var bL;bL=bK.s;return bL.$==0?true:bL.$==2?true:false;};v.IsObsolete=function(bK){return bK.s.$==1?true:false;};v.IsForever=function(bK){return bK.s.$==0?true:false;};v.CreateWithValue=function(bK){return v.Make({$:2,$0:bK,$1:[]});};v.CreateForever=function(bK){return v.Make({$:0,$0:bK});};v.Create=function(){return v.Make({$:3,$0:[],$1:[]});};v.Make=function(bK){return{s:bK};};w=d.Var=by.Class({RId:function(){return"uinref"+a.String(this.i);},RView:function(){return this.v;},RUpdM:function(bK){var bL,bM;bL=bK(this.c);(bL!=null?bL.$==1:false)?(bM=bL.$0,w.Set(this,bM)):void 0;},RUpd:function(bK){w.Update(this,bK);},set_RVal:function(bK){w.Set(this,bK);},RVal:function(){return this.c;},RSet:function(bK){w.Set(this,bK);},RGet:function(){return this.c;}},null,w);w.New=function(bK,bL,bM,bN,bO){return new w({o:bK,c:bL,s:bM,i:bN,v:bO});};w.Lens=function(bK,bL,bM){var bN,bO,bP;bN=h.Id();bO=(bP=bK.RView(),x.Map(bL,bP));return{RId:function(){return bN;},RView:function(){return bO;},RUpdM:function(bQ){return bK.RUpdM(function(bR){var bS;bS=bQ(bL(bR));return bS==null?null:{$:1,$0:bM(bR,bS.$0)};});},RUpd:function(bQ){return bK.RUpd(function(bR){return bM(bR,bQ(bL(bR)));});},set_RVal:function(bQ){return bK.RUpd(function(bR){return bM(bR,bQ);});},RVal:function(){return bL(bK.RGet());},RSet:function(bQ){return bK.RUpd(function(bR){return bM(bR,bQ);});},RGet:function(){return bL(bK.RGet());}};};w.Update=function(bK,bL){var bM;bM=bL(bK.c);w.Set(bK,bM);};w.SetFinal=function(bK,bL){if(bK.o)(function(bM){return bM("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bM){a.console.log(bM);}));else{v.MarkObsolete(bK.s);bK.o=true;bK.c=bL;bK.s=v.CreateForever(bL);}};w.Set=function(bK,bL){if(bK.o)(function(bM){return bM("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bM){a.console.log(bM);}));else{v.MarkObsolete(bK.s);bK.c=bL;bK.s=v.CreateWithValue(bL);}};w.Create=function(){var bK;bK=null;bK=w.New(false,null,v.CreateWithValue(),h.Int(),function(){return bK.s;});return bK;};w.Create$1=function(bK){var bL;bL=null;bL=w.New(false,bK,v.CreateWithValue(bK),h.Int(),function(){return bL.s;});return bL;};x.get_Do=function(){return{$:0};};x.Apply=function(bK,bL){return x.Map2(function(bM,bN){return bM(bN);},bK,bL);};x.AsyncAwait=function(bK,bL){var bM;bM=function(bN){var bO,bP;function bQ(){return x.RemovableSink(function(bR){if(bK(bR)){(bG.Force(bO))();bN(bR);}},bL);}bO=bG.Create(bQ);bP=bG.Force(bO);};return bA.FromContinuations(function(bN,bO,bP){return bM.apply(null,[bN,bO,bP]);});};x.RemovableSink=function(bK,bL){var bM;function bN(){var bO;bO=bL();v.When(bO,function(bP){if(bM[0])bK(bP);},function(){if(bM[0])l.Schedule(bN);});}bM=[true];l.Schedule(bN);return function(){bM[0]=false;};};x.Sink=function(bK,bL){function bM(){var bN;bN=bL();v.When(bN,bK,function(){l.Schedule(bM);});}l.Schedule(bM);};x.TryFinally=function(bK,bL){return x.CreateLazy(function(){try{return bL();}finally{bK();}});};x.TryWith=function(bK,bL){return x.CreateLazy(function(){try{return bL();}catch(bM){return(bK(bM))();}});};x.ConstAsync=function(bK){var bL;bL=v.CreateForeverAsync(bK);return function(){return bL;};};x.Const=function(bK){var bL;bL=v.CreateForever(bK);return function(){return bL;};};x.Sequence=function(bK){return x.CreateLazy(function(){var bL;return v.Sequence((bL=function(bM){return bM();},function(bM){return bw.map(bL,bM);}(bK)));});};x.UpdateWhile=function(bK,bL,bM){var bN;bN=[bK];return x.BindInner(function(bO){return bO?x.Map(function(bP){bN[0]=bP;return bP;},bM):x.Const(bN[0]);},bL);};x.BindInner=function(bK,bL){return x.JoinInner(x.Map(bK,bL));};x.JoinInner=function(bK){return x.CreateLazy(function(){return v.JoinInner(bK());});};x.Bind=function(bK,bL){return x.Join(x.Map(bK,bL));};x.Join=function(bK){return x.CreateLazy(function(){return v.Join(bK());});};x.MapSeqCachedView=function(bK,bL){var bM;bM=function(){return bK;};return x.MapSeqCachedViewBy(a.id,function(bN,bO){return(bM(bN))(bO);},bL);};x.MapSeqCachedViewBy=function(bK,bL,bM){var bN,bO;bN=[new bH.New$5()];bO=function(bP){var bQ,bR,bS,bT;bQ=bN[0];bR=new bH.New$5();bS=(bT=function(bU){var bV,bW,bX,bY;bV=bK(bU);bW=bQ.ContainsKey(bV)?(bX=bQ.get_Item(bV),(bY=bX.r,w.Set(bY,bU),bX)):x.ConvertSeqNode(function(bZ){return bL(bV,bZ);},bU);bR.set_Item(bV,bW);return bW.e;},function(bU){return e.mapInPlace(bT,bU);}(bq.ofSeq(bP)));bN[0]=bR;return bS;};return function(bP){return x.Map(bO,bP);}(bM);};x.ConvertSeqNode=function(bK,bL){var bM,bN;bM=w.Create$1(bL);bN=bM.v;return{e:bK(bN),r:bM,w:bN};};x.MapSeqCached=function(bK,bL){return x.MapSeqCachedBy(a.id,bK,bL);};x.MapSeqCachedBy=function(bK,bL,bM){var bN,bO;bN=[new bH.New$5()];bO=function(bP){var bQ,bR,bS,bT;bQ=bN[0];bR=new bH.New$5();bS=(bT=function(bU){var bV,bW;bV=bK(bU);bW=bQ.ContainsKey(bV)?bQ.get_Item(bV):bL(bU);bR.set_Item(bV,bW);return bW;},function(bU){return e.mapInPlace(bT,bU);}(bq.ofSeq(bP)));bN[0]=bR;return bS;};return function(bP){return x.Map(bO,bP);}(bM);};x.SnapshotOn=function(bK,bL,bM){var bN;bN=v.CreateWithValue(bK);return x.CreateLazy(function(){var bO,bP;bO=bL();return v.IsObsolete(bN)?(bP=bM(),v.SnapshotOn(bO,bP)):(v.WhenObsolete(bO,v.Obs(bN)),bN);});};x.GetAsync=function(bK){return bA.FromContinuations(function(bL){return x.Get(bL,bK);});};x.Get=function(bK,bL){var bM;function bN(){v.When(bL(),function(bO){if(!bM[0]){bM[0]=true;bK(bO);}},function(){if(!bM[0])bN();});}bM=[false];bN();};x.MapAsync2=function(bK,bL,bM){var bN;bN=a.id;return function(bO){return x.MapAsync(bN,bO);}(x.Map2(bK,bL,bM));};x.MapAsync=function(bK,bL){return x.CreateLazy(function(){var bM;bM=bL();return v.MapAsync(bK,bM);});};x.Map3=function(bK,bL,bM,bN){return x.CreateLazy(function(){var bO,bP,bQ;bO=bL();bP=bM();bQ=bN();return v.Map3(bK,bO,bP,bQ);});};x.Map2Unit=function(bK,bL){return x.CreateLazy(function(){var bM,bN;bM=bK();bN=bL();return v.Map2Unit(bM,bN);});};x.Map2=function(bK,bL,bM){return x.CreateLazy(function(){var bN,bO;bN=bL();bO=bM();return v.Map2(bK,bN,bO);});};x.MapCached=function(bK,bL){return x.MapCachedBy(bz.Equals,bK,bL);};x.MapCachedBy=function(bK,bL,bM){var bN;bN=[null];return x.CreateLazy(function(){var bO;bO=bM();return v.MapCachedBy(bK,bN,bL,bO);});};x.Map=function(bK,bL){return x.CreateLazy(function(){var bM;bM=bL();return v.Map(bK,bM);});};x.CreateLazy=function(bK){var bL;bL={c:null,o:bK};return function(){var bM;bM=bL.c;return bM===null?(bM=bL.o(),bL.c=bM,v.IsForever(bM)?bL.o=null:v.WhenObsolete(bM,function(){bL.c=null;}),bM):bM;};};y=d.Submitter=by.Class({Trigger:function(){var bK;bK=this["var"];w.Set(bK,null);}},null,y);y.New=by.Ctor(function(bK,bL){var bM,bN;this.input=bK;this["var"]=w.Create();this.view=(bM=this["var"].v,(bN=this.input,x.SnapshotOn(bL,bM,bN)));},y);y.CreateOption=function(bK){return new y.New(x.Map(function(bL){return{$:1,$0:bL};},bK),null);};z.Fresh=function(){return{$:0,$0:h.Int()};};A=d.Model=by.Class({},null,A);A.New=by.Ctor(function(bK,bL){var bM,bN,bO;bM=w.Create$1(bL);bN=(bO=bM.v,x.Map(bK,bO));A.New$1.call(this,bM,bN);},A);A.New$1=by.Ctor(function(bK,bL){this["var"]=bK;this.view=bL;},A);A.Update=function(bK,bL){var bM;bM=bL["var"];w.Update(bM,function(bN){bK(bN);return bN;});};A.Create=function(bK,bL){return new A.New(bK,bL);};B.Default=function(){H.$cctor();return H.Default;};D=C.ArrayStorage=by.Class({SSet:function(bK){return bq.ofSeq(bK);},SSetAt:function(bK,bL,bM){bq.set(bM,bK,bL);return bM;},SRemoveIf:function(bK,bL){var bM;return bq.filter((bM=function(bN){return!bN;},function(bN){return bM(bK(bN));}),bL);},SInit:function(){return this.init;},SPrependMany:function(bK,bL){var bM;bM=bL.unshift.apply(bL,e.ofSeqNonCopying(bK));return bL;},SPrepend:function(bK,bL){var bM;bM=bL.unshift(bK);return bL;},SAppendMany:function(bK,bL){var bM;bM=bL.push.apply(bL,e.ofSeqNonCopying(bK));return bL;},SAppend:function(bK,bL){var bM;bM=bL.push(bK);return bL;}},null,D);D.New=by.Ctor(function(bK){this.init=bK;},D);E=C.LocalStorageBackend=by.Class({clear:function(){this.storage.removeItem(this.id);},set:function(bK){var bL,bM;this.storage.setItem(this.id,(bL=(bM=this.serializer.Encode,function(bN){return bq.map(bM,bN);}(bK)),a.JSON.stringify(bL)));return bK;},SSet:function(bK){return this.set(bq.ofSeq(bK));},SSetAt:function(bK,bL,bM){bq.set(bM,bK,bL);return this.set(bM);},SRemoveIf:function(bK,bL){var bM;return this.set(bq.filter((bM=function(bN){return!bN;},function(bN){return bM(bK(bN));}),bL));},SInit:function(){var bK,bL,bM;bK=this.storage.getItem(this.id);if(bK===null)return[];else try{bL=a.JSON.parse(bK);bM=this.serializer.Decode;return function(bN){return bq.map(bM,bN);}(bL);}catch(bN){return[];}},SPrependMany:function(bK,bL){var bM;bM=bL.unshift.apply(bL,e.ofSeqNonCopying(bK));return this.set(bL);},SPrepend:function(bK,bL){var bM;bM=bL.unshift(bK);return this.set(bL);},SAppendMany:function(bK,bL){var bM;bM=bL.push.apply(bL,e.ofSeqNonCopying(bK));return this.set(bL);},SAppend:function(bK,bL){var bM;bM=bL.push(bK);return this.set(bL);}},null,E);E.New=by.Ctor(function(bK,bL){this.id=bK;this.serializer=bL;this.storage=a.window.localStorage;},E);C.LocalStorage=function(bK,bL){return new E.New(bK,bL);};C.InMemory=function(bK){return new D.New(bK);};F=d.ListModel=by.Class({Wrap:function(bK,bL,bM){var bN;bN=function(bO,bP){return bM(bO,bP);};return F.Wrap(this,bK,bL,function(bO,bP){return bN(bO,bP);});},Lens:function(bK){var bL;bL=function(bM,bN){return bN;};return this.LensInto(a.id,function(bM,bN){return bL(bM,bN);},bK);},LensInto:function(bK,bL,bM){var bN,bO,bP,bQ;bN=this;bO=h.Id();bP=(bQ=this.FindByKeyAsView(bM),x.Map(bK,bQ));return{RId:function(){return bO;},RView:function(){return bP;},RUpdM:function(bR){return bN.UpdateBy(function(bS){var bT;bT=bR(bK(bS));return bT==null?null:{$:1,$0:bL(bS,bT.$0)};},bM);},RUpd:function(bR){return bN.UpdateBy(function(bS){return{$:1,$0:bL(bS,bR(bK(bS)))};},bM);},set_RVal:function(bR){return this.RSet(bR);},RVal:function(){return this.RGet();},RSet:function(bR){return bN.UpdateBy(function(bS){return{$:1,$0:bL(bS,bR)};},bM);},RGet:function(){return bK(bN.FindByKey(bM));}};},get_LengthAsView:function(){var bK;bK=this["var"].RView();return x.Map(bq.length,bK);},get_Length:function(){return bq.length(this["var"].RVal());},Clear:function(){this["var"].set_RVal(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(bK,bL){var bM,bN,bO,bP,bQ;bM=this;bN=this["var"].RVal();bO=bq.tryFindIndex(function(bR){return bz.Equals(bM.key(bR),bL);},bN);(bO!=null?bO.$==1:false)?(bP=bO.$0,bQ=bK(bq.get(bN,bP)),(bQ!=null?bQ.$==1:false)?(this["var"].set_RVal(this.storage.SSetAt(bP,bQ.$0,bN)),this.ObsoleteKey(bL)):void 0):void 0;},UpdateAll:function(bK){var bL,bM;bL=this;bM=this["var"];bM.RUpd(function(bN){var bO;bO=function(bP,bQ){var bR;bR=function(bS){bq.set(bN,bP,bS);};return function(bS){if(bS==null);else bR(bS.$0);}(bK(bQ));};(function(bP){bq.iteri(bO,bP);}(bN));return bL.storage.SSet(bN);});this.ObsoleteAll();},FindByKeyAsView:function(bK){var bL;bL=function(bM){return bM.$0;};return function(bM){return x.Map(bL,bM);}(this.TryFindByKeyAsView(bK));},TryFindByKeyAsView:function(bK){var bL;bL=this;return function(){var bM,bN,bO,bP;bM=(bN=null,[bL.it.TryGetValue(bK,{get:function(){return bN;},set:function(bQ){bN=bQ;}}),bN]);return bM[0]?bM[1]:(bO=bL.TryFindByKey(bK),(bP=v.CreateWithValue(bO),(bL.it.Add(bK,bP),bP)));};},TryFindByKey:function(bK){var bL;bL=this;return bq.tryFind(function(bM){return bz.Equals(bL.key(bM),bK);},this["var"].RVal());},FindByKey:function(bK){var bL;bL=this;return bq.find(function(bM){return bz.Equals(bL.key(bM),bK);},this["var"].RVal());},TryFindAsView:function(bK){var bL;bL=function(bM){return bq.tryFind(bK,bM);};return function(bM){return x.Map(bL,bM);}(this["var"].RView());},FindAsView:function(bK){var bL;bL=function(bM){return bq.find(bK,bM);};return function(bM){return x.Map(bL,bM);}(this["var"].RView());},TryFind:function(bK){return bq.tryFind(bK,this["var"].RVal());},Find:function(bK){return bq.find(bK,this["var"].RVal());},ContainsKeyAsView:function(bK){var bL,bM,bN;bL=this;bM=(bN=function(bO){return bz.Equals(bL.key(bO),bK);},function(bO){return bq.exists(bN,bO);});return function(bO){return x.Map(bM,bO);}(this["var"].RView());},ContainsKey:function(bK){var bL;bL=this;return bq.exists(function(bM){return bz.Equals(bL.key(bM),bK);},this["var"].RVal());},Set:function(bK){this["var"].set_RVal(this.storage.SSet(bK));this.ObsoleteAll();},Iter:function(bK){bq.iter(bK,this["var"].RVal());},RemoveByKey:function(bK){var bL,bM,bN;bL=this;this["var"].set_RVal((bM=this.storage,(bN=this["var"].RVal(),bM.SRemoveIf(function(bO){return bz.Equals(bL.key(bO),bK);},bN))));this.ObsoleteKey(bK);},RemoveBy:function(bK){var bL,bM,bN,bO;bL=this["var"].RVal();for(bM=0,bN=bL.length-1;bM<=bN;bM++){bO=bq.get(bL,bM);bK(bO)?this.ObsoleteKey(this.key(bO)):void 0;}this["var"].set_RVal(this.storage.SRemoveIf(bK,this["var"].RVal()));},Remove:function(bK){var bL,bM,bN,bO,bP;bL=this;bM=this["var"].RVal();G.Contains(bL.key,bK,bM)?(bN=bL.key,bO=bN(bK),this["var"].set_RVal((bP=this.storage,bP.SRemoveIf(function(bQ){return bz.Equals(bN(bQ),bO);},bM))),this.ObsoleteKey(bO)):void 0;},PrependMany:function(bK){var bL,bM,bN,bO;bL=this;bM=new bD.New$2();this["var"].set_RVal(this.storage.SPrependMany(bM,(bN=this["var"].RVal(),((bO=function(bP,bQ){var bR,bS;bR=bL.key(bQ);bL.ObsoleteKey(bR);bS=bq.tryFindIndex(function(bT){return bz.Equals(bL.key(bT),bR);},bP);return bS==null?(bM.Add(bQ),bP):bL.storage.SSetAt(bS.$0,bQ,bP);},(by.Curried3(bw.fold))(bO))(bN))(bK))));},Prepend:function(bK){var bL,bM,bN,bO;bL=this;bM=this["var"].RVal();bN=this.key(bK);bO=bq.tryFindIndex(function(bP){return bz.Equals(bL.key(bP),bN);},bM);(bO!=null?bO.$==1:false)?this["var"].set_RVal(this.storage.SSetAt(bO.$0,bK,bM)):this["var"].set_RVal(this.storage.SPrepend(bK,bM));this.ObsoleteKey(bN);},AppendMany:function(bK){var bL,bM,bN,bO;bL=this;bM=new bD.New$2();this["var"].set_RVal(this.storage.SAppendMany(bM,(bN=this["var"].RVal(),((bO=function(bP,bQ){var bR,bS;bR=bL.key(bQ);bL.ObsoleteKey(bR);bS=bq.tryFindIndex(function(bT){return bz.Equals(bL.key(bT),bR);},bP);return bS==null?(bM.Add(bQ),bP):bL.storage.SSetAt(bS.$0,bQ,bP);},(by.Curried3(bw.fold))(bO))(bN))(bK))));},Append:function(bK){var bL,bM,bN,bO;bL=this;bM=this["var"].RVal();bN=this.key(bK);bO=bq.tryFindIndex(function(bP){return bz.Equals(bL.key(bP),bN);},bM);(bO!=null?bO.$==1:false)?this["var"].set_RVal(this.storage.SSetAt(bO.$0,bK,bM)):this["var"].set_RVal(this.storage.SAppend(bK,bM));this.ObsoleteKey(bN);},ObsoleteAll:function(){var bK;bK=function(bL){v.MarkObsolete(bL.V);};(function(bL){bw.iter(bK,bL);}(this.it));this.it.Clear();},ObsoleteKey:function(bK){var bL,bM,bN,bO;bL=(bM=null,[this.it.TryGetValue(bK,{get:function(){return bM;},set:function(bP){bM=bP;}}),bM]);bL[0]?(bN=bL[1],v.MarkObsolete(bN),bO=this.it.Remove(bK)):void 0;},GetEnumerator0:function(){return br.Get0(this["var"].RVal());},GetEnumerator:function(){return br.Get(this["var"].RVal());}},null,F);F.New=by.Ctor(function(bK,bL){var bM;bM=w.Create$1(bq.ofSeq(bw.distinctBy(bK,bL.SInit())));F.New$3.call(this,bK,bM,bL);},F);F.New$1=by.Ctor(function(bK){F.New$2.call(this,bK,[]);},F);F.New$2=by.Ctor(function(bK,bL){var bM;bM=bq.ofSeq(bL);F.New$3.call(this,bK,w.Create$1(bM),C.InMemory(bM));},F);F.New$3=by.Ctor(function(bK,bL,bM){var bN;this.key=bK;this["var"]=bL;this.storage=bM;this.v=(bN=this["var"].RView(),x.Map(function(bO){return bO.slice();},bN));this.it=new bH.New$5();},F);G.Contains=function(bK,bL,bM){var bN;bN=bK(bL);return bq.exists(function(bO){return bz.Equals(bK(bO),bN);},bM);};F.Wrap=function(bK,bL,bM,bN){var bO,bP,bQ,bR,bS,bT;bO=[new bH.New$5()];bP=(bQ=function(bU){var bV;bV=bM(bU);bO[0].set_Item(bK.key(bU),bV);return bV;},function(bU){return bq.map(bQ,bU);}(bK["var"].RVal()));bR=(bS=bK["var"],(bT=function(bU){var bV,bW,bX;bV=new bH.New$5();bW=(bX=function(bY){var bZ,b0;bZ=bK.key(bY);b0=bO[0].ContainsKey(bZ)?bN(bO[0].get_Item(bZ),bY):bM(bY);bV.set_Item(bZ,b0);return b0;},function(bY){return bq.map(bX,bY);}(bU));bO[0]=bV;return bW;},function(bU){return w.Lens(bS,bT,function(bV,bW){return(bU(bV))(bW);});})(function(){return function(bU){var bV,bW,bX;bV=new bH.New$5();bW=(bX=function(bY){var bZ;bZ=bL(bY);bV.set_Item(bK.key(bZ),bY);return bZ;},function(bY){return bq.map(bX,bY);}(bU));bO[0]=bV;return bW;};}));return new F.New$3(function(bU){var bV;bV=bK.key;return function(bW){return bV(bL(bW));}(bU);},bR,C.InMemory(bP));};F.FromSeq=function(bK){return F.Create(a.id,bK);};F.Create=function(bK,bL){var bM;bM=C.InMemory(bq.ofSeq(bL));return F.CreateWithStorage(bK,bM);};F.CreateWithStorage=function(bK,bL){return new F.New(bK,bL);};H.$cctor=by.Cctor(function(){H.Default={Encode:a.id,Decode:a.id};H.$cctor=a.ignore;});I=d.ReactiveExtensions=by.Class({},null,I);I.New=by.Ctor(function(){},I);J=d.DoubleInterpolation=by.Class({Interpolate:function(bK,bL,bM){return bL+bK*(bM-bL);}},null,J);K.get_Double=function(){return new J({$:0});};L=d.Easing=by.Class({TransformTime:function(bK){return this.transformTime(bK);}},null,L);L.get_CubicInOut=function(){return M.CubicInOut();};L.Custom=function(bK){return new L.New(bK);};L.New=by.Ctor(function(bK){this.transformTime=bK;},L);M.CubicInOut=function(){Q.$cctor();return Q.CubicInOut;};N.get_Empty=function(){return{$:0,$0:p.Empty()};};N.WhenDone=function(bK,bL){var bM;bM={$:0,$0:p.Single({$:0,$0:bK})};return function(bN){return N.Append(bM,bN);}(bL);};N.Run=function(bK,bL){var bM,bN;bM=bL.Duration;bN=function(bO){var bP;function bQ(bR,bS){var bT,bU;bT=bS-bR;bL.Compute(bT);bK();return bT<=bM?(bU=a.requestAnimationFrame(function(bV){bQ(bR,bV);}),void 0):bO();}bP=a.requestAnimationFrame(function(bR){bQ(bR,bR);});};return bA.FromContinuations(function(bO,bP,bQ){return bN.apply(null,[bO,bP,bQ]);});};N.Play=function(bK){return bA.Delay(function(){var bL,bM;bL=(bM=function(){},function(bN){return N.Run(bM,bN);}(O.Actions(bK)));return bA.Bind(bL,function(){O.Finalize(bK);return bA.Return(null);});});};N.Pack=function(bK){return{$:0,$0:p.Single({$:1,$0:bK})};};N.Map=function(bK,bL){var bM;return O.Def(bL.Duration,(bM=bL.Compute,function(bN){return bK(bM(bN));}));};N.Delayed=function(bK,bL,bM,bN,bO,bP){return{Compute:function(bQ){return bQ<=bN?bO:bK.Interpolate(bL.TransformTime((bQ-bN)/bM),bO,bP);},Duration:bM+bN};};N.Simple=function(bK,bL,bM,bN,bO){return{Compute:function(bP){return bK.Interpolate(bL.TransformTime(bP/bM),bN,bO);},Duration:bM};};N.Const=function(bK){return O.Const(bK);};N.Concat=function(bK){return{$:0,$0:p.Concat(bw.map(O.List,bK))};};N.Append=function(bK,bL){var bM,bN;bM=bK.$0;bN=bL.$0;return{$:0,$0:p.Append(bM,bN)};};N.set_UseAnimations=function(bK){O.set_UseAnimations(bK);};N.get_UseAnimations=function(){return O.UseAnimations();};O.UseAnimations=function(){Q.$cctor();return Q.UseAnimations;};O.set_UseAnimations=function(bK){Q.$cctor();Q.UseAnimations=bK;};O.Actions=function(bK){var bL,bM;bL=bK.$0;return O.ConcatActions((bM=function(bN){return bN.$==1?{$:1,$0:bN.$0}:null;},function(bN){return bq.choose(bM,bN);}(p.ToArray(bL))));};O.ConcatActions=function(bK){var bL,bM,bN,bO,bP;bL=e.ofSeqNonCopying(bK);bM=bq.length(bL);return bM===0?O.Const():bM===1?bq.get(bL,0):(bN=bw.max((bO=function(bQ){return bQ.Duration;},function(bQ){return bw.map(bO,bQ);}(bL))),(bP=bq.map(function(bQ){return O.Prolong(bN,bQ);},bL),O.Def(bN,function(bQ){bq.iter(function(bR){bR.Compute(bQ);},bP);})));};O.Prolong=function(bK,bL){var bM,bN,bO;bM=bL.Compute;bN=bL.Duration;bO=bG.Create(function(){return bL.Compute(bL.Duration);});return{Compute:function(bP){return bP>=bN?bO.f():bM(bP);},Duration:bK};};O.Const=function(bK){return O.Def(0,function(){return bK;});};O.Def=function(bK,bL){return{Compute:bL,Duration:bK};};O.Finalize=function(bK){var bL,bM;bL=bK.$0;bM=function(bN){if(bN.$==0)bN.$0();};(function(bN){bq.iter(bM,bN);}(p.ToArray(bL)));};O.List=function(bK){return bK.$0;};P=d.Trans=by.Class({Copy:function(bK,bL,bM,bN){var bO,bP,bQ,bR,bS;bO=this;bP=bE.DefaultArg(bK,function(bT){return function(bU){return bO.TChange(bT,bU);};});bQ=bE.DefaultArg(bL,this.get_TEnter());bR=bE.DefaultArg(bM,this.get_TExit());bS=bE.DefaultArg(bN,this.get_TFlags());return new P.New$3(function(bT,bU){return(bP(bT))(bU);},bQ,bR,bS);},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(bK,bL){return this.change(bK,bL);}},null,P);P.New=by.Ctor(function(bK,bL,bM){P.New$3.call(this,bK,bz.Equals(bL,null)?N.Const:bL,bz.Equals(bM,null)?N.Const:bM,1|(bz.Equals(bL,null)?0:2)|(bz.Equals(bM,null)?0:4));},P);P.New$1=by.Ctor(function(bK){P.New$3.call(this,bK,N.Const,N.Const,1);},P);P.New$2=by.Ctor(function(){P.New$3.call(this,function(bK,bL){return N.Const(bL);},N.Const,N.Const,0);},P);P.New$3=by.Ctor(function(bK,bL,bM,bN){this.change=bK;this.enter=bL;this.exit=bM;this.flags=bN;},P);P.Exit=function(bK,bL){return bL.Copy(null,null,{$:1,$0:bK},{$:1,$0:bL.get_TFlags()|4});};P.Enter=function(bK,bL){return bL.Copy(null,{$:1,$0:bK},null,{$:1,$0:bL.get_TFlags()|2});};P.Change=function(bK,bL){return bL.Copy({$:1,$0:bK},null,null,{$:1,$0:bL.get_TFlags()|1});};P.Create=function(bK){return new P.New$1(bK);};P.Trivial=function(){return new P.New$2();};P.CanAnimateExit=function(bK){var bL,bM;bL=bK.get_TFlags();bM=4;return(bL&bM)===bM;};P.CanAnimateEnter=function(bK){var bL,bM;bL=bK.get_TFlags();bM=2;return(bL&bM)===bM;};P.CanAnimateChange=function(bK){var bL,bM;bL=bK.get_TFlags();bM=1;return(bL&bM)===bM;};P.AnimateExit=function(bK,bL){return(bK.get_TExit())(bL);};P.AnimateEnter=function(bK,bL){return(bK.get_TEnter())(bL);};P.AnimateChange=function(bK,bL,bM){return bK.TChange(bL,bM);};Q.$cctor=by.Cctor(function(){Q.CubicInOut=L.Custom(function(bK){var bL;bL=bK*bK;return 3*bL-2*(bL*bK);});Q.UseAnimations=true;Q.$cctor=a.ignore;});R=d.AnimatedAttrNode=by.Class({sync:function(bK){var bL,bM;if(this.dirty){bL=this.logical;bL==null?void 0:(bM=bL.$0,(this.push(bK))(bM));this.visible=this.logical;this.dirty=false;}},pushVisible:function(bK,bL){this.visible={$:1,$0:bL};this.dirty=true;(this.push(bK))(bL);},NChanged:function(){return this.updates;},NSync:function(bK){},NGetExitAnim:function(bK){var bL,bM,bN,bO,bP,bQ;bL=this;bM=function(){bL.dirty=true;bL.visible=null;};return function(bR){return N.WhenDone(bM,bR);}((bN=this.visible,(bN!=null?bN.$==1:false)?(bO=bN.$0,N.Pack((bP=function(bR){bL.pushVisible(bK,bR);},function(bR){return N.Map(bP,bR);}((bQ=this.tr,P.AnimateExit(bQ,bO)))))):N.get_Empty()));},NGetEnterAnim:function(bK){var bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX;bL=this;bM=function(){bL.sync(bK);};return function(bY){return N.WhenDone(bM,bY);}((bN=this.visible,(bO=this.logical,((bN!=null?bN.$==1:false)?(bO!=null?bO.$==1:false)?this.dirty?(bP=[bO.$0,bN.$0],true):false:false:false)?(bQ=bP[0],(bR=bP[1],N.Pack((bS=function(bY){bL.pushVisible(bK,bY);},function(bY){return N.Map(bS,bY);}((bT=this.tr,P.AnimateChange(bT,bR,bQ))))))):(bN==null?(bO!=null?bO.$==1:false)?true:false:false)?(bV=bO.$0,N.Pack((bW=function(bY){bL.pushVisible(bK,bY);},function(bY){return N.Map(bW,bY);}((bX=this.tr,P.AnimateEnter(bX,bV)))))):N.get_Empty())));},NGetChangeAnim:function(bK){var bL,bM,bN,bO,bP,bQ,bR,bS,bT;bL=this;bM=function(){bL.sync(bK);};return function(bU){return N.WhenDone(bM,bU);}((bN=this.visible,(bO=this.logical,((bN!=null?bN.$==1:false)?(bO!=null?bO.$==1:false)?this.dirty?(bP=[bO.$0,bN.$0],true):false:false:false)?(bQ=bP[0],(bR=bP[1],N.Pack((bS=function(bU){bL.pushVisible(bK,bU);},function(bU){return N.Map(bS,bU);}((bT=this.tr,P.AnimateChange(bT,bR,bQ))))))):N.get_Empty())));}},null,R);R.New=by.Ctor(function(bK,bL,bM){var bN,bO;bN=this;this.tr=bK;this.push=bM;this.logical=null;this.visible=null;this.dirty=true;this.updates=(bO=function(bP){bN.logical={$:1,$0:bP};bN.dirty=true;},function(bP){return x.Map(bO,bP);}(bL));},R);S=d.DynamicAttrNode=by.Class({NChanged:function(){return this.updates;},NSync:function(bK){if(this.dirty){(this.push(bK))(this.value);this.dirty=false;}},NGetExitAnim:function(bK){return N.get_Empty();},NGetEnterAnim:function(bK){return N.get_Empty();},NGetChangeAnim:function(bK){return N.get_Empty();}},null,S);S.New=by.Ctor(function(bK,bL){var bM,bN;bM=this;this.push=bL;this.value=void 0;this.dirty=false;this.updates=(bN=function(bO){bM.value=bO;bM.dirty=true;},function(bO){return x.Map(bN,bO);}(bK));},S);T=d.AttrProxy=by.Class({},null,T);T.Handler=function(bK,bL){return X.Static(function(bM){bM.addEventListener(bK,function(bN){return(bL(bM))(bN);},false);});};T.Concat=function(bK){var bL,bM;bL=e.ofSeqNonCopying(bK);bM=X.EmptyAttr();return e.TreeReduce(bM,T.Append,bL);};T.Append=function(bK,bL){return X.AppendTree(bK,bL);};T.Create=function(bK,bL){return X.Static(function(bM){r.SetAttr(bM,bK,bL);});};W.New=function(bK,bL,bM,bN){var bO;bO={DynElem:bK,DynFlags:bL,DynNodes:bM};by.SetOptional(bO,"OnAfterRender",bN);return bO;};X.Static=function(bK){return new T({$:3,$0:bK});};X.Dynamic=function(bK,bL){return new T({$:1,$0:new S.New(bK,bL)});};X.Animated=function(bK,bL,bM){var bN,bO,bP;bN=new R.New(bK,bL,bM);bO=4;P.CanAnimateEnter(bK)?bO=bO|1:void 0;P.CanAnimateExit(bK)?bO=bO|2:void 0;bP=new T({$:1,$0:bN});X.SetFlags(bP,bO);return bP;};X.EmptyAttr=function(){_0.$cctor();return _0.EmptyAttr;};X.AppendTree=function(bK,bL){return bK===null?bL:bL===null?bK:new T({$:2,$0:bK,$1:bL});};X.GetChangeAnim=function(bK){return X.GetAnim(bK,function(bL,bM){return bL.NGetChangeAnim(bM);});};X.GetExitAnim=function(bK){return X.GetAnim(bK,function(bL,bM){return bL.NGetExitAnim(bM);});};X.GetEnterAnim=function(bK){return X.GetAnim(bK,function(bL,bM){return bL.NGetEnterAnim(bM);});};X.GetAnim=function(bK,bL){var bM;return N.Concat((bM=function(bN){return bL(bN,bK.DynElem);},function(bN){return bq.map(bM,bN);}(bK.DynNodes)));};X.Updates=function(bK){var bL,bM;bL=bK.DynNodes;bM=x.Const();return e.MapTreeReduce(function(bN){return bN.NChanged();},bM,x.Map2Unit,bL);};X.Empty=function(bK){return W.New(bK,0,[],null);};X.Insert=function(bK,bL){var bM,bN,bO;function bP(bQ){var bR;if(!(bQ===null))if(bQ!=null?bQ.$==1:false)bM.push(bQ.$0);else if(bQ!=null?bQ.$==2:false){bR=bQ.$1;bP(bQ.$0);bP(bR);}else if(bQ!=null?bQ.$==3:false)bQ.$0(bK);else if(bQ!=null?bQ.$==4:false)bN.push(bQ.$0);}bM=[];bN=[];bP(bL);bO=bM.slice(0);return W.New(bK,X.Flags(bL),bO,bN.length===0?null:{$:1,$0:function(bQ){bw.iter(function(bR){bR(bQ);},bN);}});};X.Sync=function(bK,bL){var bM;bM=function(bN){bN.NSync(bK);};(function(bN){bq.iter(bM,bN);}(bL.DynNodes));};X.SetFlags=function(bK,bL){bK.flags=bL;};X.Flags=function(bK){return(bK!==null?bK.hasOwnProperty("flags"):false)?bK.flags:0;};X.HasExitAnim=function(bK){var bL;bL=2;return(bK.DynFlags&bL)===bL;};X.HasEnterAnim=function(bK){var bL;bL=1;return(bK.DynFlags&bL)===bL;};X.HasChangeAnim=function(bK){var bL;bL=4;return(bK.DynFlags&bL)===bL;};Y=d.CheckedInput=by.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,Y);Y.Make=function(bK){return new Y({$:0,$0:bK,$1:a.String(bK)});};Z.ValidateForm=function(){return Z.OnAfterRender(function(bK){if(a.H5F)a.H5F.setup(bK);});};Z.Checked=function(bK){var bL;bL=function(bM){return!bz.Equals(bK.RVal(),bM.checked)?bK.set_RVal(bM.checked):null;};return T.Concat([Z.DynamicProp("checked",bK.RView()),Z.Handler("change",function(bM){return function(bN){return bL(bM,bN);};}),Z.Handler("click",function(bM){return function(bN){return bL(bM,bN);};})]);};Z.FloatValue=function(bK){return Z.CustomVar(bK,function(bL,bM){var bN;bN=bM.get_Input();return bL.value!==bN?void(bL.value=bN):null;},function(bL){var bM,bN;bM=bL.value;return{$:1,$0:f.isBlank(bM)?(bL.checkValidity?bL.checkValidity():true)?new Y({$:2,$0:bM}):new Y({$:1,$0:bM}):(bN=+bM,a.isNaN(bN)?new Y({$:1,$0:bM}):new Y({$:0,$0:bN,$1:bM}))};});};Z.FloatValueUnchecked=function(bK){return Z.CustomValue(bK,a.String,function(bL){var bM;return f.isBlank(bL)?{$:1,$0:0}:(bM=+bL,a.isNaN(bM)?null:{$:1,$0:bM});});};Z.IntValue=function(bK){return Z.CustomVar(bK,function(bL,bM){var bN;bN=bM.get_Input();return bL.value!==bN?void(bL.value=bN):null;},function(bL){var bM,bN,bO,bP;bM=bL.value;return{$:1,$0:f.isBlank(bM)?(bL.checkValidity?bL.checkValidity():true)?new Y({$:2,$0:bM}):new Y({$:1,$0:bM}):(bN=(bO=0,[bI.TryParse(bM,{get:function(){return bO;},set:function(bQ){bO=bQ;}}),bO]),bN[0]?(bP=bN[1],new Y({$:0,$0:bP,$1:bM})):new Y({$:1,$0:bM}))};});};Z.IntValueUnchecked=function(bK){return Z.CustomValue(bK,a.String,function(bL){var bM;return f.isBlank(bL)?{$:1,$0:0}:(bM=+bL,bM!==bM>>0?null:{$:1,$0:bM});});};Z.Value=function(bK){var bL,bM;return Z.CustomValue(bK,a.id,(bL=a.id,(bM=function(bN){return{$:1,$0:bN};},function(bN){return bM(bL(bN));})));};Z.ContentEditableHtml=function(bK){var bL,bM;bL=Z.CustomVar(bK,function(bN,bO){bN.innerHTML=bO;},function(bN){return{$:1,$0:bN.innerHTML};});bM=T.Create("contenteditable","true");return T.Append(bM,bL);};Z.ContentEditableText=function(bK){var bL,bM;bL=Z.CustomVar(bK,function(bN,bO){bN.textContent=bO;},function(bN){return{$:1,$0:bN.textContent};});bM=T.Create("contenteditable","true");return T.Append(bM,bL);};Z.CustomValue=function(bK,bL,bM){return Z.CustomVar(bK,function(bN,bO){bN.value=bL(bO);},function(bN){return bM(bN.value);});};Z.CustomVar=function(bK,bL,bM){var bN,bO;bN=function(bP){return bK.RUpdM(function(bQ){var bR,bS,bT;bR=bM(bP);return((bR!=null?bR.$==1:false)?(bT=bR.$0,!bz.Equals(bT,bQ))?(bS=[bR,bR.$0],true):false:false)?bS[0]:null;});};bO=function(bP,bQ){var bR,bS,bT;bR=bM(bP);return((bR!=null?bR.$==1:false)?(bT=bR.$0,bz.Equals(bT,bQ))?(bS=bR.$0,true):false:false)?null:bL(bP,bQ);};return T.Concat([Z.Handler("change",function(bP){return function(bQ){return bN(bP,bQ);};}),Z.Handler("input",function(bP){return function(bQ){return bN(bP,bQ);};}),Z.Handler("keypress",function(bP){return function(bQ){return bN(bP,bQ);};}),Z.DynamicCustom(function(bP){return function(bQ){return bO(bP,bQ);};},bK.RView())]);};Z.DynamicProp=function(bK,bL){return X.Dynamic(bL,function(bM){return function(bN){bM[bK]=bN;};});};Z.DynamicPred=function(bK,bL,bM){var bN,bO;bN=function(bP,bQ){var bR,bS;bR=bQ[0];bS=bQ[1];return bR?r.SetAttr(bP,bK,bS):r.RemoveAttr(bP,bK);};bO=x.Map2(function(bP,bQ){return[bP,bQ];},bL,bM);return X.Dynamic(bO,function(bP){return function(bQ){return bN(bP,bQ);};});};Z.DynamicClass=function(bK,bL,bM){return X.Dynamic(bL,function(bN){return function(bO){return bM(bO)?r.AddClass(bN,bK):r.RemoveClass(bN,bK);};});};Z.OnAfterRenderView=function(bK,bL){var bM,bN,bO;bM=h.Id();bN=Z.OnAfterRender(function(bP){bL(bP,bP[bM]);});bO=Z.DynamicCustom(function(bP){return function(bQ){bP[bM]=bQ;};},bK);return T.Append(bN,bO);};Z.OnAfterRender=function(bK){return new T({$:4,$0:bK});};Z.HandlerView=function(bK,bL,bM){return X.Static(function(bN){var bO;bO=bM(bN);bN.addEventListener(bK,function(bP){var bQ;bQ=bO(bP);return x.Get(bQ,bL);},false);});};Z.Handler=function(bK,bL){return X.Static(function(bM){bM.addEventListener(bK,function(bN){return(bL(bM))(bN);},false);});};Z.DynamicStyle=function(bK,bL){return X.Dynamic(bL,function(bM){return function(bN){return r.SetStyle(bM,bK,bN);};});};Z.DynamicCustom=function(bK,bL){return X.Dynamic(bL,bK);};Z.Dynamic=function(bK,bL){return X.Dynamic(bL,function(bM){return function(bN){return r.SetAttr(bM,bK,bN);};});};Z.AnimatedStyle=function(bK,bL,bM,bN){return X.Animated(bL,bM,function(bO){return function(bP){return r.SetStyle(bO,bK,bN(bP));};});};Z.Animated=function(bK,bL,bM,bN){return X.Animated(bL,bM,function(bO){return function(bP){return r.SetAttr(bO,bK,bN(bP));};});};Z.Class=function(bK){return X.Static(function(bL){r.AddClass(bL,bK);});};Z.Style=function(bK,bL){return X.Static(function(bM){r.SetStyle(bM,bK,bL);});};_0.$cctor=by.Cctor(function(){_0.EmptyAttr=null;_0.$cctor=a.ignore;});_1=d.DocElemNode=by.Class({GetHashCode:function(){return this.ElKey;},Equals:function(bK){return this.ElKey===bK.ElKey;}},null,_1);_1.New=function(bK,bL,bM,bN,bO,bP){var bQ;return new _1((bQ={Attr:bK,Children:bL,El:bN,ElKey:bO},(by.SetOptional(bQ,"Delimiters",bM),by.SetOptional(bQ,"Render",bP),bQ)));};_3.FoldBack=function(bK,bL,bM){var bN;bN=bL.$0;return bq.foldBack(bK,bN,bM);};_3.Iter=function(bK,bL){var bM;bM=bL.$0;bq.iter(bK,bM);};_3.Except=function(bK,bL){var bM,bN,bO;bM=bK.$0;bN=bL.$0;return{$:0,$0:(bO=function(bP){var bQ;bQ=function(bR){return!(bP===bR);};return function(bR){return bq.forall(bQ,bR);}(bM);},function(bP){return bq.filter(bO,bP);}(bN))};};_3.DocChildren=function(bK){var bL;function bM(bN){var bO,bP,bQ;if(bN.$==2)bM(bN.$0.Current);else if(bN.$==1)bL.push(bN.$0.El);else if(bN.$==3);else if(bN.$==5)bL.push(bN.$0);else if(bN.$==4)bL.push(bN.$0.Text);else if(bN.$==6){bO=bN.$0;bP=function(bR){if(bR.constructor===a.Object)bM(bR);else bL.push(bR);};(function(bR){bq.iter(bP,bR);}(bO.Els));}else{bQ=bN.$1;bM(bN.$0);bM(bQ);}}bL=[];bM(bK.Children);return{$:0,$0:e.ofSeqNonCopying(bL)};};_3.Children=function(bK,bL){var bM,bN,bO,bP,bQ,bR;if(bL!=null?bL.$==1:false){bO=bL.$0[1];bP=bL.$0[0];bQ=a.Array.prototype.constructor.apply(a.Array,[]);bM=bP.nextSibling;while(bM!==bO){bR=bQ.push(bM);bM=bM.nextSibling;}return{$:0,$0:bQ};}else return{$:0,$0:bq.init(bK.childNodes.length,(bN=bK.childNodes,function(bS){return bN[bS];}))};};_4.ToArray=function(bK){return i.ToArray(bK.$0);};_4.get_Empty=function(){return{$:0,$0:new bv.New$3()};};_4.IsEmpty=function(bK){return bK.$0.get_Count()===0;};_4.Intersect=function(bK,bL){var bM,bN;bM=bK.$0;bN=bL.$0;return{$:0,$0:i.Intersect(bM,bN)};};_4.Except=function(bK,bL){var bM,bN;bM=bK.$0;bN=bL.$0;return{$:0,$0:i.Except(bM,bN)};};_4.FindAll=function(bK){var bL;function bM(bO){var bP,bQ,bR;if(bO.$==0){bP=bO.$1;bM(bO.$0);bM(bP);}else if(bO.$==1)bN(bO.$0);else if(bO.$==2)bM(bO.$0.Current);else if(bO.$==6){bQ=bO.$0;bR=bQ.Holes;bq.iter(bN,bR);}}function bN(bO){bL.push(bO);bM(bO.Children);}bL=[];bM(bK);return{$:0,$0:new bv.New$2(bL)};};_4.Filter=function(bK,bL){var bM;bM=bL.$0;return{$:0,$0:i.Filter(bK,bM)};};_5.New=function(bK,bL){return{PreviousNodes:bK,Top:bL};};_6.TextHoleRE=function(){_.$cctor();return _.TextHoleRE;};_6.LoadedTemplates=function(){_.$cctor();return _.LoadedTemplates;};_6.UpdateTextNode=function(bK,bL){bK.Value=bL;bK.Dirty=true;};_6.CreateTextNode=function(){return{Text:r.CreateText(""),Dirty:false,Value:""};};_6.UpdateEmbedNode=function(bK,bL){bK.Current=bL;bK.Dirty=true;};_6.CreateEmbedNode=function(){return{Current:{$:3},Dirty:false};};_6.PerformAnimatedUpdate=function(bK,bL){var bM;return N.get_UseAnimations()?bA.Delay(function(){var bN,bO,bP,bQ,bR;bN=_4.FindAll(bL);bO=_6.ComputeChangeAnim(bK,bN);bP=_6.ComputeEnterAnim(bK,bN);bQ=_6.ComputeExitAnim(bK,bN);bR=N.Play(N.Append(bO,bQ));return bA.Bind(bR,function(){var bS;_6.SyncElemNode(bK.Top);bS=N.Play(bP);return bA.Bind(bS,function(){bK.PreviousNodes=bN;return bA.Return(null);});});}):(bM=function(bN){var bO;bO=a.requestAnimationFrame(function(){_6.SyncElemNode(bK.Top);bN();});},bA.FromContinuations(function(bN,bO,bP){return bM.apply(null,[bN,bO,bP]);}));};_6.ComputeEnterAnim=function(bK,bL){var bM,bN,bO,bP;return N.Concat((bM=function(bQ){return X.GetEnterAnim(bQ.Attr);},function(bQ){return bq.map(bM,bQ);}(_4.ToArray((bN=(bO=function(bQ){return X.HasEnterAnim(bQ.Attr);},function(bQ){return _4.Filter(bO,bQ);}(bL)),(bP=bK.PreviousNodes,_4.Except(bP,bN)))))));};_6.ComputeChangeAnim=function(bK,bL){var bM,bN,bO,bP,bQ;bM=(bN=function(bR){return X.HasChangeAnim(bR.Attr);},function(bR){return _4.Filter(bN,bR);});return N.Concat((bO=function(bR){return X.GetChangeAnim(bR.Attr);},function(bR){return bq.map(bO,bR);}(_4.ToArray((bP=bM(bK.PreviousNodes),(bQ=bM(bL),_4.Intersect(bP,bQ)))))));};_6.ComputeExitAnim=function(bK,bL){var bM,bN,bO;return N.Concat((bM=function(bP){return X.GetExitAnim(bP.Attr);},function(bP){return bq.map(bM,bP);}(_4.ToArray((bN=(bO=function(bP){return X.HasExitAnim(bP.Attr);},function(bP){return _4.Filter(bO,bP);}(bK.PreviousNodes)),_4.Except(bL,bN))))));};_6.CreateDelimitedRunState=function(bK,bL,bM){return _5.New(_4.get_Empty(),_6.CreateDelimitedElemNode(bK,bL,X.EmptyAttr(),bM));};_6.CreateRunState=function(bK,bL){return _5.New(_4.get_Empty(),_6.CreateElemNode(bK,X.EmptyAttr(),bL));};_6.CreateDelimitedElemNode=function(bK,bL,bM,bN){var bO,bP;bO=bK.parentElement;_6.LinkPrevElement(bL,bN);bP=X.Insert(bO,bM);return _1.New(bP,bN,{$:1,$0:[bK,bL]},bO,h.Int(),by.GetOptional(bP.OnAfterRender));};_6.CreateElemNode=function(bK,bL,bM){var bN;_6.LinkElement(bK,bM);bN=X.Insert(bK,bL);return _1.New(bN,bM,null,bK,h.Int(),by.GetOptional(bN.OnAfterRender));};_6.SyncElemNode=function(bK){_6.SyncElement(bK);_6.Sync(bK.Children);_6.AfterRender(bK);};_6.Sync=function(bK){var bL,bM,bN,bO,bP;if(bK.$==1)_6.SyncElemNode(bK.$0);else if(bK.$==2){bL=bK.$0;_6.Sync(bL.Current);}else if(bK.$==3);else if(bK.$==5);else if(bK.$==4){bM=bK.$0;bM.Dirty?(bM.Text.nodeValue=bM.Value,bM.Dirty=false):void 0;}else if(bK.$==6){bN=bK.$0;bq.iter(function(bQ){_6.SyncElemNode(bQ);},bN.Holes);bq.iter(function(bQ){var bR,bS;bR=bQ[0];bS=bQ[1];X.Sync(bR,bS);},bN.Attrs);_6.AfterRender(bN);}else{bO=bK.$1;bP=bK.$0;_6.Sync(bP);_6.Sync(bO);}};_6.AfterRender=function(bK){var bL,bM;bL=by.GetOptional(bK.Render);(bL!=null?bL.$==1:false)?(bM=bL.$0,bM(bK.El),by.SetOptional(bK,"Render",null)):void 0;};_6.InsertBeforeDelim=function(bK,bL){var bM,bN,bO;bM=bK.parentElement;bN=a.document.createTextNode("");bO=bM.insertBefore(bN,bK);_6.LinkPrevElement(bK,bL);return bN;};_6.LinkPrevElement=function(bK,bL){var bM;bM=_6.InsertDoc(bK.parentElement,bL,bK);};_6.LinkElement=function(bK,bL){var bM;bM=_6.InsertDoc(bK,bL,null);};_6.SyncElement=function(bK){function bL(bM){function bN(bO){var bP,bQ,bR;return bO.$==0?(bP=bO.$1,bN(bO.$0)?true:bN(bP)):bO.$==2?(bQ=bO.$0,bQ.Dirty?true:bN(bQ.Current)):bO.$==6?(bR=bO.$0,bR.Dirty?true:bq.exists(bL,bR.Holes)):false;}return bN(bM.Children);}X.Sync(bK.El,bK.Attr);bL(bK)?_6.DoSyncElement(bK):void 0;};_6.DoSyncElement=function(bK){var bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU;function bV(bW,bX){var bY,bZ;return bW.$==1?bW.$0.El:bW.$==2?(bY=bW.$0,bY.Dirty?(bY.Dirty=false,_6.InsertDoc(bL,bY.Current,bX)):bV(bY.Current,bX)):bW.$==3?bX:bW.$==4?bW.$0.Text:bW.$==5?bW.$0:bW.$==6?(bZ=bW.$0,(bZ.Dirty?bZ.Dirty=false:void 0,bq.foldBack(function(b0,b1){return b0.constructor===a.Object?bV(b0,b1):b0;},bZ.Els,bX))):bV(bW.$0,bV(bW.$1,bX));}bL=bK.El;bM=_3.DocChildren(bK);bN=(bO=(bP=bK.El,(bQ=by.GetOptional(bK.Delimiters),_3.Children(bP,bQ))),_3.Except(bM,bO));bR=(bS=bK.El,function(bW){r.RemoveNode(bS,bW);});_3.Iter(bR,bN);bU=bV(bK.Children,(bT=by.GetOptional(bK.Delimiters),(bT!=null?bT.$==1:false)?bT.$0[1]:null));};_6.InsertDoc=function(bK,bL,bM){var bN,bO,bP,bQ,bR,bS,bT;return bL.$==1?(bN=bL.$0,_6.InsertNode(bK,bN.El,bM)):bL.$==2?(bO=bL.$0,(bO.Dirty=false,_6.InsertDoc(bK,bO.Current,bM))):bL.$==3?bM:bL.$==4?(bP=bL.$0,_6.InsertNode(bK,bP.Text,bM)):bL.$==5?(bQ=bL.$0,_6.InsertNode(bK,bQ,bM)):bL.$==6?(bR=bL.$0,bq.foldBack(function(bU,bV){return bU.constructor===a.Object?_6.InsertDoc(bK,bU,bV):_6.InsertNode(bK,bU,bV);},bR.Els,bM)):(bS=bL.$1,(bT=bL.$0,_6.InsertDoc(bK,bT,_6.InsertDoc(bK,bS,bM))));};_6.InsertNode=function(bK,bL,bM){r.InsertAt(bK,bM,bL);return bL;};_7=d.Doc=by.Class({ReplaceInDom:function(bK){var bL,bM;bL=a.document.createTextNode("");bM=bK.parentNode.replaceChild(bL,bK);_7.RunBefore(bL,this);}},null,_7);_7.Append=function(bK,bL){var bM,bN,bO,bP;bM=(bN=bK.updates,(bO=bL.updates,x.Map2Unit(bN,bO)));bP={$:0,$0:bK.docNode,$1:bL.docNode};return _7.Mk(bP,bM);};_7.Concat=function(bK){var bL,bM;bL=e.ofSeqNonCopying(bK);bM=_7.Empty();return e.TreeReduce(bM,_7.Append,bL);};_7.Empty=function(){var bK;bK=x.Const();return _7.Mk({$:3},bK);};_7.TextNode=function(bK){var bL,bM;bL={$:5,$0:r.CreateText(bK)};bM=x.Const();return _7.Mk(bL,bM);};_7.Verbatim=function(bK){var bL,bM,bN,bO;bL=(bM=a.jQuery.parseHTML(bK),bz.Equals(bM,null)?[]:bM);bN=e.MapTreeReduce(function(bP){return bz.Equals(bP.nodeType,a.Node.TEXT_NODE)?{$:5,$0:bP}:{$:1,$0:_6.CreateElemNode(bP,X.EmptyAttr(),{$:3})};},{$:3},function(bP,bQ){return{$:0,$0:bP,$1:bQ};},bL);bO=x.Const();return _7.Mk(bN,bO);};_7.SvgElementMixed=function(bK,bL){var bM,bN,bO;bM=_7.MixedNodes(bL);bN=bM[1];bO=bM[0];return _7.SvgElement(bK,bO,bN);};_7.SvgElement=function(bK,bL,bM){var bN,bO,bP;bN=T.Concat(bL);bO=_7.Concat(bM);bP=r.CreateSvgElement(bK);return _8.New(bP,bN,bO);};_7.ElementMixed=function(bK,bL){var bM,bN,bO;bM=_7.MixedNodes(bL);bN=bM[1];bO=bM[0];return _7.Element(bK,bO,bN);};_7.ConcatMixed=function(bK){return _7.Concat(bw.map(_7.ToMixedDoc,bK));};_7.MixedNodes=function(bK){var bL,bM,bN,bO;bL=new bD.New$2();bM=new bD.New$2();bN=br.Get(bK);try{while(bN.MoveNext()){bO=bN.Current();bO instanceof T?bL.Add(bO):bM.Add(_7.ToMixedDoc(bO));}}finally{if("Dispose"in bN)bN.Dispose();}return[bL,bM];};_7.ToMixedDoc=function(bK){var bL;return bK instanceof _7?bK:typeof bK=="string"?_7.TextNode(bK):bK instanceof a.Element?_7.Static(bK):typeof bK=="function"?_7.EmbedView(x.Map(_7.ToMixedDoc,bK)):bK instanceof w?_7.EmbedView((bL=bK.v,x.Map(_7.ToMixedDoc,bL))):bz.Equals(bK,null)?_7.Empty():_7.TextNode(a.String(bK));};_7.Element=function(bK,bL,bM){var bN,bO,bP;bN=T.Concat(bL);bO=_7.Concat(bM);bP=r.CreateElement(bK);return _8.New(bP,bN,bO);};_7.Radio=function(bK,bL,bM){var bN,bO,bP,bQ,bR,bS,bT;bN=r.CreateElement("input");bN.addEventListener("click",function(){return bM.RSet(bL);},false);bO=(bP=bM.RView(),x.Map(function(bU){return bz.Equals(bU,bL);},bP));bQ=Z.DynamicProp("checked",bO);bR=T.Create;bS=T.Concat(bp.append(bp.ofArray([bR("type","radio"),bR("name",bM.RId()),bQ]),bp.ofSeq(bK)));bT=_7.Empty();return _8.New(bN,bS,bT);};_7.LinkView=function(bK,bL,bM,bN){var bO,bP,bQ,bR;bO=Z.HandlerView("click",bM,function(){return function(){return bN;};});bP=T.Concat(bw.append([bO,T.Create("href","#")],bL));bQ=r.CreateElement("a");bR=_7.TextNode(bK);return _8.New(bQ,bP,bR);};_7.Link=function(bK,bL,bM){var bN,bO,bP,bQ,bR;bN=(bO=T.Concat(bL),(bP=T.Create("href","#"),T.Append(bP,bO)));bQ=_7.Clickable("a",bM);bR=_7.TextNode(bK);return _8.New(bQ,bN,bR);};_7.ButtonView=function(bK,bL,bM,bN){var bO,bP,bQ,bR;bO=Z.HandlerView("click",bM,function(){return function(){return bN;};});bP=T.Concat(bw.append([bO],bL));bQ=r.CreateElement("button");bR=_7.TextNode(bK);return _8.New(bQ,bP,bR);};_7.Button=function(bK,bL,bM){var bN,bO,bP;bN=T.Concat(bL);bO=_7.Clickable("button",bM);bP=_7.TextNode(bK);return _8.New(bO,bN,bP);};_7.Clickable=function(bK,bL){var bM;bM=r.CreateElement(bK);bM.addEventListener("click",function(bN){bN.preventDefault();return bL();},false);return bM;};_7.CheckBoxGroup=function(bK,bL,bM){var bN,bO,bP;bN=(bO=function(bQ,bR){return bR?bp.exists(function(bS){return bz.Equals(bL,bS);},bQ)?bQ:new bp.T({$:1,$0:bL,$1:bQ}):bp.filter(function(bS){return!bz.Equals(bL,bS);},bQ);},w.Lens(bM,(bP=function(bQ){return bz.Equals(bL,bQ);},function(bQ){return bp.exists(bP,bQ);}),function(bQ,bR){return bO(bQ,bR);}));return _7.CheckBox(bK,bN);};_7.CheckBox=function(bK,bL){return _7.InputInternal("input",function(){return bw.append(bK,[T.Create("type","checkbox"),Z.Checked(bL)]);});};_7.SelectDynOptional=function(bK,bL,bM,bN,bO){var bP,bQ;bP=(bQ=function(bR){return new bp.T({$:1,$0:null,$1:bp.map(function(bS){return{$:1,$0:bS};},bR)});},function(bR){return x.Map(bQ,bR);}(bN));return _7.SelectDyn(bK,function(bR){return(bR!=null?bR.$==1:false)?bM(bR.$0):bL;},bP,bO);};_7.SelectOptional=function(bK,bL,bM,bN,bO){var bP;bP=new bp.T({$:1,$0:null,$1:bp.map(function(bQ){return{$:1,$0:bQ};},bN)});return _7.Select(bK,function(bQ){return(bQ!=null?bQ.$==1:false)?bM(bQ.$0):bL;},bP,bO);};_7.Select=function(bK,bL,bM,bN){return _7.SelectImpl(bK,bL,function(bO){var bP;bO[0]=bM;return _7.Concat((bP=function(bQ,bR){var bS,bT;bS=bp.ofArray([T.Create("value",a.String(bQ))]);bT=bp.ofArray([_7.TextNode(bL(bR))]);return _7.Element("option",bS,bT);},function(bQ){return bp.mapi(bP,bQ);}(bM)));},bN);};_7.SelectDyn=function(bK,bL,bM,bN){return _7.SelectImpl(bK,bL,function(bO){var bP,bQ;bP=function(bR,bS){var bT,bU;bT=bp.ofArray([T.Create("value",a.String(bR))]);bU=bp.ofArray([_7.TextNode(bL(bS))]);return _7.Element("option",bT,bU);};return function(bR){return _7.Convert(function(bS){return bP(bS[0],bS[1]);},bR);}((bQ=function(bR){var bS;bO[0]=bR;bS=function(bT,bU){return[bT,bU];};return function(bT){return bw.mapi(bS,bT);}(bR);},function(bR){return x.Map(bQ,bR);}(bM)));},bN);};_7.SelectImpl=function(bK,bL,bM,bN){var bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1;bO=[new bp.T({$:0})];bP=function(b2){return b2.selectedIndex;};bQ=function(b2,b3){b2.selectedIndex=b3;};bR=function(b2){return bO[0].get_Item(bP(b2));};bS=function(b2){return bw.findIndex(function(b3){return bz.Equals(b2,b3);},bO[0]);};bT=function(b2,b3){return bQ(b2,bS(b3));};bU=r.CreateElement("select");bV=(bW=bN.RView(),Z.DynamicCustom(function(b2){return function(b3){return bT(b2,b3);};},bW));bU.addEventListener("change",function(){bN.RUpdM(function(b2){var b3;b3=bR(bU);return bz.Equals(b2,b3)?null:{$:1,$0:b3};});},false);bX=(bY=(bZ=T.Concat(bK),T.Append(bV,bZ)),(b0=Z.OnAfterRender(function(b2){bT(b2,bN.RGet());}),T.Append(b0,bY)));b1=bM(bO);return _8.New(bU,bX,b1);};_7.InputArea=function(bK,bL){return _7.InputInternal("textarea",function(){return bw.append(bK,[Z.Value(bL)]);});};_7.FloatInput=function(bK,bL){return _7.InputInternal("input",function(){return bw.append(bK,[Z.FloatValue(bL),T.Create("type","number")]);});};_7.FloatInputUnchecked=function(bK,bL){return _7.InputInternal("input",function(){return bw.append(bK,[bL.RGet()===0?T.Create("value","0"):X.EmptyAttr(),Z.FloatValueUnchecked(bL),T.Create("type","number")]);});};_7.IntInput=function(bK,bL){return _7.InputInternal("input",function(){return bw.append(bK,[Z.IntValue(bL),T.Create("type","number")]);});};_7.IntInputUnchecked=function(bK,bL){return _7.InputInternal("input",function(){return bw.append(bK,[bL.RGet()===0?T.Create("value","0"):X.EmptyAttr(),Z.IntValueUnchecked(bL),T.Create("type","number")]);});};_7.PasswordBox=function(bK,bL){return _7.InputInternal("input",function(){return bw.append(bK,[Z.Value(bL),T.Create("type","password")]);});};_7.Input=function(bK,bL){return _7.InputInternal("input",function(){return bw.append(bK,[Z.Value(bL)]);});};_7.InputInternal=function(bK,bL){var bM,bN,bO;bM=r.CreateElement(bK);bN=T.Concat(bL(bM));bO=_7.Empty();return _8.New(bM,bN,bO);};_7.ConvertSeqBy=function(bK,bL,bM){return _7.Flatten(x.MapSeqCachedViewBy(bK,function(bN,bO){return(bL(bN))(bO);},bM));};_7.ConvertSeq=function(bK,bL){return _7.Flatten(x.MapSeqCachedView(bK,bL));};_7.ConvertBy=function(bK,bL,bM){return _7.Flatten(x.MapSeqCachedBy(bK,bL,bM));};_7.Convert=function(bK,bL){return _7.Flatten(x.MapSeqCached(bK,bL));};_7.Flatten=function(bK){return _7.EmbedView(x.Map(_7.Concat,bK));};_7.GetOrLoadTemplate=function(bK,bL,bM,bN){_7.PrepareTemplate(bK,bL,bM);return _7.NamedTemplate(bK,bL,bN);};_7.NamedTemplate=function(bK,bL,bM){var bN,bO,bP,bQ,bR;bN=_7.ComposeName(bK,bL);bO=(bP=null,[_6.LoadedTemplates().TryGetValue(bN,{get:function(){return bP;},set:function(bS){bP=bS;}}),bP]);return bO[0]?(bQ=bO[1],(bR=bQ.cloneNode(true),_7.ChildrenTemplate(bR,bM))):(a.console.warn.apply(a.console,["Local template doesn't exist"].concat([bN])),_7.Empty());};_7.LoadLocalTemplates=function(bK){(function(){var bL,bM,bN,bO,bP;while(true){bM=a.document.querySelector("[ws-template]");if(bz.Equals(bM,null)){bN=a.document.querySelector("[ws-children-template]");if(bz.Equals(bN,null))return null;else{bO=bN.getAttribute("ws-children-template");bN.removeAttribute("ws-children-template");bL=function(bQ){return function(){return r.ChildrenArray(bQ);};}(bN);_7.PrepareTemplate(bK,{$:1,$0:bO},bL);}}else{bP=bM.getAttribute("ws-template");_7.PrepareSingleTemplate(bK,{$:1,$0:bP},bM);}}}());};_7.PrepareTemplate=function(bK,bL,bM){var bN,bO,bP,bQ,bR,bS;if(!_6.LoadedTemplates().ContainsKey(_7.ComposeName(bK,bL))){bN=bM();for(bO=0,bP=bN.length-1;bO<=bP;bO++){bQ=bq.get(bN,bO);bR=bQ.parentElement;bz.Equals(bR,null)?void 0:bS=bR.removeChild(bQ);}_7.PrepareTemplateStrict(bK,bL,bN);}};_7.PrepareTemplateStrict=function(bK,bL,bM){var bN,bO,bP,bQ,bR,bS,bT,bU;function bV(b0,b1,b2){var b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr;while(true)switch(b0){case 0:b_=bJ.string(b1.nodeName,{$:1,$0:3},null).toLowerCase();b$=(b3=b_.indexOf(a.String.fromCharCode(46)),b3===-1?bK+"/"+b_:bs.Replace(b_,".","/"));if(!_6.LoadedTemplates().ContainsKey(b$))return a.console.warn.apply(a.console,["Instantiating non-loaded template"].concat([b$]));else{ca=_6.LoadedTemplates().get_Item(b$);cb=ca.cloneNode(true);cc=new bv.New$3();cd=new bH.New$5();ce=b1.attributes;for(cf=0,cg=ce.length-1;cf<=cg;cf++){ch=ce.item(cf).name.toLowerCase();ci=(cj=ce.item(cf).nodeValue,cj===""?ch:cj.toLowerCase());cd.set_Item(ch,ci);!cc.Add(ch)?a.console.warn.apply(a.console,["Hole mapped twice"].concat([ch])):void 0;}for(ck=0,cl=b1.childNodes.length-1;ck<=cl;ck++){cm=b1.childNodes[ck];bz.Equals(cm.nodeType,a.Node.ELEMENT_NODE)?!cc.Add(cm.nodeName.toLowerCase())?a.console.warn.apply(a.console,["Hole filled twice"].concat([b$])):void 0:void 0;}cn=b1.childNodes.length===1?bz.Equals(b1.firstChild.nodeType,a.Node.TEXT_NODE):false;if(cn){b5=bS(cb,b1.firstChild.textContent);b6=(b7=function(cs){return function(ct){return cs.Add(ct);};}(cc),b8=function(){},function(cs){return b8(b7(cs));});((function(cs){return function(ct){if(ct==null);else cs(ct.$0);};}(b6))(b5));}bR(cb,cc);if(!cn){for(co=0,cp=b1.childNodes.length-1;co<=cp;co++){cq=b1.childNodes[co];bz.Equals(cq.nodeType,a.Node.ELEMENT_NODE)?cq.hasAttributes()?bQ(cb,cq):bW(cb,cq):void 0;}}bP(cb,cd);(((function(cs){var ct;ct=function(cu,cv){return bT(cs,cu,cv);};return function(cu){return function(cv){return ct(cu,cv);};};}(cb))(b1.parentElement))(b1));return b9=b1.parentElement.removeChild(b1);}case 1:if(b2!==null){cr=b2.nextSibling;if(bz.Equals(b2.nodeType,a.Node.TEXT_NODE))bO(b2);else if(bz.Equals(b2.nodeType,a.Node.ELEMENT_NODE))bY(b2);b0=1;b1=b1;b2=cr;}else return null;}}function bW(b0,b1){var b2,b3,b5,b6,b7;function b4(b8,b9){var b_,b$,ca,cb,cc,cd;if(b5==="title"?b1.hasChildNodes():false){ca=(b_=b1.textContent,a.jQuery.parseHTML(b_));b$=b1.removeChild(b1.firstChild);for(cb=0,cc=ca.length-1;cb<=cc;cb++){cd=b1.appendChild(bq.get(ca,cb));}}else null;bY(b1);return bT(b1,b8,b9);}b5=b1.nodeName.toLowerCase();r.IterSelector(b0,"[ws-attr-holes]",function(b8){var b9,b_,b$,ca,cb,cc,cd,ce;b_=(b9=b8.getAttribute("ws-attr-holes"),bs.SplitChars(b9,[32],1));for(b$=0,ca=b_.length-1;b$<=ca;b$++){cb=bq.get(b_,b$);b8.setAttribute(cb,(cc=new a.RegExp("\\${"+b5+"}","ig"),cd=b8.getAttribute(cb),ce=b1.textContent,cc[a.Symbol.replace](cd,ce)));}});b6=b0.querySelector("[ws-hole="+b5+"]");if(bz.Equals(b6,null)){b2=b0.querySelector("[ws-replace="+b5+"]");return bz.Equals(b2,null)?null:(b4(b2.parentElement,b2),b3=b2.parentElement.removeChild(b2));}else{while(b6.hasChildNodes()){b7=b6.removeChild(b6.lastChild);}b6.removeAttribute("ws-hole");return b4(b6,null);}}function bX(b0){return bV(0,b0);}function bY(b0){var b1,b2,b3,b4;if((b1=b0.nodeName.toLowerCase(),bs.StartsWith(b1,"ws-"))?!b0.hasAttribute("ws-template"):false)bX(b0);else{bN(b0);b2=b0.getAttribute("ws-template");if(b2===null){b3=b0.getAttribute("ws-children-template");if(b3===null)bZ(b0,b0.firstChild);else{b0.removeAttribute("ws-children-template");_7.PrepareTemplate(bK,{$:1,$0:b3},function(){return r.ChildrenArray(b0);});while(b0.hasChildNodes()){b4=b0.removeChild(b0.lastChild);}}}else _7.PrepareSingleTemplate(bK,{$:1,$0:b2},b0);}}function bZ(b0,b1){return bV(1,b0,b1);}bN=function(b0){var b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf;function b1(cg){var ch;ch=b0.getAttribute(cg);ch===null?void 0:b0.setAttribute(cg,ch.toLowerCase());}b2=b0.attributes;b3=[];b4=[];b5=[];for(b6=0,b7=b2.length-1;b6<=b7;b6++){b8=b2.item(b6);(((b9=b8.nodeName,bs.StartsWith(b9,"ws-on"))?b8.nodeName!=="ws-onafterrender":false)?b8.nodeName!=="ws-on":false)?(b_=b3.push(b8.nodeName),b$=b4.push(bJ.string(b8.nodeName,{$:1,$0:"ws-on".length},null)+":"+b8.nodeValue.toLowerCase())):(!(ca=b8.nodeName,bs.StartsWith(ca,"ws-"))?(cb=_6.TextHoleRE(),new a.RegExp(cb)).test(b8.nodeValue):false)?(b8.nodeValue=(cc=(cd=_6.TextHoleRE(),new a.RegExp(cd,"g")),(ce=b8.nodeValue,cc[a.Symbol.replace](ce,function(cg,ch){return"${"+ch.toLowerCase()+"}";}))),cf=b5.push(b8.nodeName)):void 0;}!(b4.length==0)?b0.setAttribute("ws-on",bs.concat(" ",b4)):void 0;!(b5.length==0)?b0.setAttribute("ws-attr-holes",bs.concat(" ",b5)):void 0;b1("ws-hole");b1("ws-replace");b1("ws-attr");b1("ws-onafterrender");b1("ws-var");bq.iter(function(cg){b0.removeAttribute(cg);},b3);};bO=function(b0){var b1,b2,b3,b4,b5,b6,b7,b8,b9;b1=null;b2=0;b5=b0.textContent;b6=(b4=_6.TextHoleRE(),new a.RegExp(b4,"g"));while(b1=b6.exec(b5),b1!==null){b7=b0.parentNode.insertBefore(a.document.createTextNode(bJ.string(b5,{$:1,$0:b2},{$:1,$0:b6.lastIndex-bq.get(b1,0).length-1})),b0);b2=b6.lastIndex;b8=a.document.createElement("span");b8.setAttribute("ws-replace",bq.get(b1,1).toLowerCase());b9=b0.parentNode.insertBefore(b8,b0);}b6.lastIndex=0;b0.textContent=bJ.string(b5,{$:1,$0:b2},null);};bP=function(b0,b1){function b2(b3){r.IterSelector(b0,"["+b3+"]",function(b4){var b5,b6;b5=(b6=null,[b1.TryGetValue(b4.getAttribute(b3).toLowerCase(),{get:function(){return b6;},set:function(b7){b6=b7;}}),b6]);b5[0]?b4.setAttribute(b3,b5[1]):void 0;});}b2("ws-hole");b2("ws-replace");b2("ws-attr");b2("ws-onafterrender");b2("ws-var");r.IterSelector(b0,"[ws-on]",function(b3){var b4,b5,b6;b3.setAttribute("ws-on",(b4=(b5=function(b7){var b8,b9,b_,b$;b8=bs.SplitChars(b7,[58],1);b9=(b_=null,[b1.TryGetValue(bq.get(b8,1),{get:function(){return b_;},set:function(ca){b_=ca;}}),b_]);return b9[0]?(b$=b9[1],bq.get(b8,0)+":"+b$):b7;},function(b7){return bq.map(b5,b7);}((b6=b3.getAttribute("ws-on"),bs.SplitChars(b6,[32],1)))),bs.concat(" ",b4)));});return r.IterSelector(b0,"[ws-attr-holes]",function(b3){var b4,b5,b6,b7;b5=(b4=b3.getAttribute("ws-attr-holes"),bs.SplitChars(b4,[32],1));for(b6=0,b7=b5.length-1;b6<=b7;b6++)(function(){var b8,b9,b_;b8=bq.get(b5,b6);return b3.setAttribute(b8,(b9=b3.getAttribute(b8),((b_=function(b$,ca){var cb,cc,cd,ce;cb=bE.KeyValue(ca);cc=cb[1];cd=cb[0];ce=new a.RegExp("\\${"+cd+"}","ig");return ce[a.Symbol.replace](b$,"${"+cc+"}");},(by.Curried3(bw.fold))(b_))(b9))(b1)));}());});};bQ=function(b0,b1){var b2,b3,b4,b5,b6;bN(b1);b2=b1.nodeName.toLowerCase();b3=b0.querySelector("[ws-attr="+b2+"]");if(bz.Equals(b3,null))return a.console.warn.apply(a.console,["Filling non-existent attr hole"].concat([b2]));else{b3.removeAttribute("ws-attr");for(b4=0,b5=b1.attributes.length-1;b4<=b5;b4++){b6=b1.attributes.item(b4);(b6.name==="class"?b3.hasAttribute("class"):false)?b3.setAttribute("class",b3.getAttribute("class")+" "+b6.nodeValue):b3.setAttribute(b6.name,b6.nodeValue);}return;}};bR=function(b0,b1){function b2(b3){r.IterSelector(b0,"["+b3+"]",function(b4){if(!b1.Contains(b4.getAttribute(b3)))b4.removeAttribute(b3);});}b2("ws-attr");b2("ws-onafterrender");b2("ws-var");r.IterSelector(b0,"[ws-hole]",function(b3){var b4;if(!b1.Contains(b3.getAttribute("ws-hole"))){b3.removeAttribute("ws-hole");while(b3.hasChildNodes()){b4=b3.removeChild(b3.lastChild);}}});r.IterSelector(b0,"[ws-replace]",function(b3){var b4;if(!b1.Contains(b3.getAttribute("ws-replace"))){b4=b3.parentElement.removeChild(b3);}});r.IterSelector(b0,"[ws-on]",function(b3){var b4,b5,b6;b3.setAttribute("ws-on",(b4=(b5=function(b7){var b8;b8=bs.SplitChars(b7,[58],1);return b1.Contains(bq.get(b8,1));},function(b7){return bq.filter(b5,b7);}((b6=b3.getAttribute("ws-on"),bs.SplitChars(b6,[32],1)))),bs.concat(" ",b4)));});return r.IterSelector(b0,"[ws-attr-holes]",function(b3){var b4,b5,b6,b7,b8,b9,b_,b$;b5=(b4=b3.getAttribute("ws-attr-holes"),bs.SplitChars(b4,[32],1));for(b6=0,b7=b5.length-1;b6<=b7;b6++){b8=bq.get(b5,b6);b3.setAttribute(b8,(b9=(b_=_6.TextHoleRE(),new a.RegExp(b_,"g")),(b$=b3.getAttribute(b8),b9[a.Symbol.replace](b$,function(ca,cb){return b1.Contains(cb)?ca:"";}))));}});};bS=function(b0,b1){var b2,b3;b2=b0.querySelector("[ws-replace]");return bz.Equals(b2,null)?(a.console.warn.apply(a.console,["Filling non-existent text hole"].concat([bL])),null):(b3=b2.parentElement.replaceChild(new a.Text(b1),b2),{$:1,$0:b2.getAttribute("ws-replace")});};bT=function(b0,b1,b2){while(true)if(b0.hasChildNodes())b2=b1.insertBefore(b0.lastChild,b2);else return null;};bU=_7.FakeRoot(bM);_6.LoadedTemplates().set_Item(_7.ComposeName(bK,bL),bU);bq.length(bM)>0?bZ(bU,bq.get(bM,0)):void 0;};_7.ComposeName=function(bK,bL){return(bK+"/"+bE.DefaultArg(bL,"")).toLowerCase();};_7.PrepareSingleTemplate=function(bK,bL,bM){var bN,bO,bP,bQ;bM.removeAttribute("ws-template");bN=bM.getAttribute("ws-replace");bN===null?void 0:(bM.removeAttribute("ws-replace"),bO=bM.parentElement,bz.Equals(bO,null)?void 0:(bP=a.document.createElement(bM.tagName),bP.setAttribute("ws-replace",bN),bQ=bO.replaceChild(bP,bM)));_7.PrepareTemplateStrict(bK,bL,[bM]);};_7.FakeRoot=function(bK){var bL,bM,bN,bO;bL=a.document.createElement("div");for(bM=0,bN=bK.length-1;bM<=bN;bM++){bO=bL.appendChild(bq.get(bK,bM));}return bL;};_7.ChildrenTemplate=function(bK,bL){var bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1;bV=[];bW=[];bX=[];bY=[];bZ=new bH.New$5();b0=br.Get(bL);try{while(b0.MoveNext()){b1=b0.Current();bZ.set_Item(b1.$0,b1);}}finally{if("Dispose"in b0)b0.Dispose();}bM=r.ChildrenArray(bK);bN=function(b2,b3){var b4,b5,b6,b7;b4=X.Insert(b2,b3);b5=bW.push(X.Updates(b4));b6=bX.push([b2,b4]);b7=function(b8){var b9;b9=bY.push(function(){b8(b2);});};return function(b8){if(b8==null);else b7(b8.$0);}(by.GetOptional(b4.OnAfterRender));};bO=function(b2){var b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf;b3=(b4=null,[bZ.TryGetValue(b2,{get:function(){return b4;},set:function(cg){b4=cg;}}),b4]);return b3[0]?b3[1].$==0?{$:1,$0:b3[1].$1}:b3[1].$==1?(b5=b3[1].$1,{$:1,$0:_7.TextNode(b5)}):b3[1].$==2?(b6=b3[1].$1,{$:1,$0:_7.TextView(b6)}):b3[1].$==6?(b7=b3[1].$1,{$:1,$0:_7.TextView(b7.RView())}):b3[1].$==7?(b8=b3[1].$1,{$:1,$0:_7.TextView((b9=b8.RView(),x.Map(a.String,b9)))}):b3[1].$==8?(b_=b3[1].$1,{$:1,$0:_7.TextView((b$=b_.RView(),x.Map(function(cg){return cg.get_Input();},b$)))}):b3[1].$==9?(ca=b3[1].$1,{$:1,$0:_7.TextView((cb=ca.RView(),x.Map(a.String,cb)))}):b3[1].$==10?(cc=b3[1].$1,{$:1,$0:_7.TextView((cd=cc.RView(),x.Map(function(cg){return cg.get_Input();},cd)))}):b3[1].$==11?(ce=b3[1].$1,{$:1,$0:_7.TextView((cf=ce.RView(),x.Map(a.String,cf)))}):(a.console.warn.apply(a.console,["Content hole filled with attribute data"].concat([b2])),null):null;};r.IterSelector(bK,"[ws-hole]",function(b2){var b3,b4,b5,b6,b7,b8;b7=b2.getAttribute("ws-hole");b2.removeAttribute("ws-hole");while(b2.hasChildNodes()){b8=b2.removeChild(b2.lastChild);}b3=bO(b7);(b3!=null?b3.$==1:false)?(b4=b3.$0,_6.LinkElement(b2,b4.docNode),b5=bV.push(_1.New(X.Empty(b2),b4.docNode,null,b2,h.Int(),null)),b6=bW.push(b4.updates)):void 0;});r.IterSelector(bK,"[ws-replace]",function(b2){var b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb;b3=b2.getAttribute("ws-replace");b4=bO(b3);(b4!=null?b4.$==1:false)?(b5=b4.$0,b6=b2.parentElement,b7=a.document.createTextNode(""),b8=b6.replaceChild(b7,b2),b9=_6.InsertBeforeDelim(b7,b5.docNode),b_=function(cc){bq.set(bM,cc,b5.docNode);},function(cc){if(cc==null);else b_(cc.$0);}((b$=function(cc){return b2===cc;},function(cc){return bq.tryFindIndex(b$,cc);}(bM))),ca=bV.push(_1.New(X.Empty(b6),b5.docNode,{$:1,$0:[b9,b7]},b6,h.Int(),null)),cb=bW.push(b5.updates)):void 0;});r.IterSelector(bK,"[ws-attr]",function(b2){var b3,b4,b5;b3=b2.getAttribute("ws-attr");b2.removeAttribute("ws-attr");b4=(b5=null,[bZ.TryGetValue(b3,{get:function(){return b5;},set:function(b6){b5=b6;}}),b5]);b4[0]?b4[1].$==3?bN(b2,b4[1].$1):a.console.warn.apply(a.console,["Attribute hole filled with non-attribute data"].concat([b3])):void 0;});r.IterSelector(bK,"[ws-on]",function(b2){var b3,b4;bN(b2,T.Concat((b3=function(b5){var b6,b7,b8,b9,b_,b$;b6=bs.SplitChars(b5,[58],1);b7=(b8=null,[bZ.TryGetValue(bq.get(b6,1),{get:function(){return b8;},set:function(ca){b8=ca;}}),b8]);return b7[0]?b7[1].$==4?(b9=b7[1].$1,{$:1,$0:Z.Handler(bq.get(b6,0),b9)}):(b_="Event hole on"+bq.get(b6,0)+" filled with non-event data",b$=[bq.get(b6,1)],a.console.warn.apply(a.console,[b_].concat(b$)),null):null;},function(b5){return bq.choose(b3,b5);}((b4=b2.getAttribute("ws-on"),bs.SplitChars(b4,[32],1))))));b2.removeAttribute("ws-on");});r.IterSelector(bK,"[ws-onafterrender]",function(b2){var b3,b4,b5,b6;b3=b2.getAttribute("ws-onafterrender");b4=(b5=null,[bZ.TryGetValue(b3,{get:function(){return b5;},set:function(b7){b5=b7;}}),b5]);b4[0]?b4[1].$==5?(b6=b4[1].$1,b2.removeAttribute("ws-onafterrender"),bN(b2,Z.OnAfterRender(b6))):a.console.warn.apply(a.console,["onafterrender hole filled with non-onafterrender data"].concat([b3])):void 0;});r.IterSelector(bK,"[ws-var]",function(b2){var b3,b4,b5,b6,b7,b8,b9,b_,b$;b3=b2.getAttribute("ws-var");b2.removeAttribute("ws-var");b4=(b5=null,[bZ.TryGetValue(b3,{get:function(){return b5;},set:function(ca){b5=ca;}}),b5]);b4[0]?b4[1].$==6?(b6=b4[1].$1,bN(b2,Z.Value(b6))):b4[1].$==7?(b7=b4[1].$1,bN(b2,Z.Checked(b7))):b4[1].$==8?(b8=b4[1].$1,bN(b2,Z.IntValue(b8))):b4[1].$==9?(b9=b4[1].$1,bN(b2,Z.IntValueUnchecked(b9))):b4[1].$==10?(b_=b4[1].$1,bN(b2,Z.FloatValue(b_))):b4[1].$==11?(b$=b4[1].$1,bN(b2,Z.FloatValueUnchecked(b$))):a.console.warn.apply(a.console,["Var hole filled with non-Var data"].concat([b3])):void 0;});r.IterSelector(bK,"[ws-attr-holes]",function(b2){var b3,b4,b5,b6,b7,b8;b5=(b3=_6.TextHoleRE(),new a.RegExp(b3,"g"));b6=(b4=b2.getAttribute("ws-attr-holes"),bs.SplitChars(b4,[32],1));b2.removeAttribute("ws-attr-holes");for(b7=0,b8=b6.length-1;b7<=b8;b7++)(function(){var b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv;cr=bq.get(b6,b7);cs=b2.getAttribute(cr);b9=null;b_=0;ct=[];while(b9=b5.exec(cs),b9!==null){cu=bJ.string(cs,{$:1,$0:b_},{$:1,$0:b5.lastIndex-bq.get(b9,0).length-1});b_=b5.lastIndex;cv=ct.push([cu,bq.get(b9,1)]);}ca=bJ.string(cs,{$:1,$0:b_},null);b5.lastIndex=0;cb=bq.foldBack(function(cw,cx){return(function(cy){var cz,cA;cz=cy[0];cA=cy[1];return function(cB){var cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS;cC=cB[0];cD=cB[1];cE=(cF=(cG=null,[bZ.TryGetValue(cA,{get:function(){return cG;},set:function(cT){cG=cT;}}),cG]),cF[0]?cF[1].$==1?{$:0,$0:cF[1].$1}:cF[1].$==2?{$:1,$0:cF[1].$1}:cF[1].$==6?{$:1,$0:cF[1].$1.RView()}:cF[1].$==7?(cH=cF[1].$1,{$:1,$0:(cI=cH.RView(),x.Map(a.String,cI))}):cF[1].$==8?(cJ=cF[1].$1,{$:1,$0:(cK=cJ.RView(),x.Map(function(cT){return cT.get_Input();},cK))}):cF[1].$==9?(cL=cF[1].$1,{$:1,$0:(cM=cL.RView(),x.Map(a.String,cM))}):cF[1].$==10?(cN=cF[1].$1,{$:1,$0:(cO=cN.RView(),x.Map(function(cT){return cT.get_Input();},cO))}):cF[1].$==11?(cP=cF[1].$1,{$:1,$0:(cQ=cP.RView(),x.Map(a.String,cQ))}):(a.console.warn.apply(a.console,["Attribute value hole filled with non-text data"].concat([cA])),{$:0,$0:""}):{$:0,$0:""});return cE.$==1?(cR=cE.$0,cS=cC===""?cR:x.Map(function(cT){return cT+cC;},cR),[cz,new bp.T({$:1,$0:cS,$1:cD})]):[cz+cE.$0+cC,cD];};}(cw))(cx);},ct,[ca,new bp.T({$:0})]);return bN(b2,cb[1].$==1?cb[1].$1.$==1?cb[1].$1.$1.$==1?cb[1].$1.$1.$1.$==0?(cc=cb[0],cd=cb[1].$0,ce=cb[1].$1.$0,cf=cb[1].$1.$1.$0,Z.Dynamic(cr,x.Map3(function(cw,cx,cy){return cc+cw+cx+cy;},cd,ce,cf))):(cg=cb[0],ch=cb[1],ci=(cj=function(cw){return cg+bs.concat("",cw);},function(cw){return x.Map(cj,cw);}(x.Sequence(ch))),Z.Dynamic(cr,ci)):(ck=cb[0],cl=cb[1].$0,cm=cb[1].$1.$0,Z.Dynamic(cr,x.Map2(function(cw,cx){return ck+cw+cx;},cl,cm))):cb[0]===""?(cn=cb[1].$0,Z.Dynamic(cr,cn)):(co=cb[0],cp=cb[1].$0,Z.Dynamic(cr,x.Map(function(cw){return co+cw;},cp))):(cq=cb[0],T.Create(cr,cq)));}());});bP=(bQ=bY.length==0?null:{$:1,$0:function(b2){bq.iter(function(b3){b3(b2);},bY);}},by.DeleteEmptyFields({Els:bM,Dirty:true,Holes:bV,Attrs:bX,Render:bQ?bQ.$0:void 0},["Render"]));bR=(bS=x.Const(),function(b2){return e.TreeReduce(bS,x.Map2Unit,b2);}(bW));return((bM?bq.length(bM)===1:false)?bq.get(bM,0)instanceof a.Node?(bU=bq.get(bM,0),bz.Equals(bU.nodeType,a.Node.ELEMENT_NODE))?(bT=bq.get(bM,0),true):false:false:false)?_8.TreeNode(bP,bR):_7.Mk({$:6,$0:bP},bR);};_7.Template=function(bK,bL){var bM;bM=_7.FakeRoot(bK);return _7.ChildrenTemplate(bM,bL);};_7.TextView=function(bK){var bL,bM,bN;bL=_6.CreateTextNode();bM={$:4,$0:bL};return function(bO){return _7.Mk(bM,bO);}((bN=function(bO){_6.UpdateTextNode(bL,bO);},function(bO){return x.Map(bN,bO);}(bK)));};_7.RunReplaceById=function(bK,bL){var bM;bM=r.Doc().getElementById(bK);bz.Equals(bM,null)?bE.FailWith("invalid id: "+bK):bL.ReplaceInDom(bM);};_7.RunById=function(bK,bL){var bM;bM=r.Doc().getElementById(bK);bz.Equals(bM,null)?bE.FailWith("invalid id: "+bK):_7.Run(bM,bL);};_7.Run=function(bK,bL){var bM,bN,bO,bP;bM=bL.docNode;_6.LinkElement(bK,bM);bN=_6.CreateRunState(bK,bM);bO=m.StartProcessor(_6.PerformAnimatedUpdate(bN,bM));bP=bL.updates;x.Sink(bO,bP);};_7.RunPrependById=function(bK,bL){var bM;bM=r.Doc().getElementById(bK);bz.Equals(bM,null)?bE.FailWith("invalid id: "+bK):_7.RunPrepend(bM,bL);};_7.RunPrepend=function(bK,bL){var bM,bN;bM=a.document.createTextNode("");bN=bK.insertBefore(bM,bK.firstChild);_7.RunBefore(bM,bL);};_7.RunAppendById=function(bK,bL){var bM;bM=r.Doc().getElementById(bK);bz.Equals(bM,null)?bE.FailWith("invalid id: "+bK):_7.RunAppend(bM,bL);};_7.RunAppend=function(bK,bL){var bM,bN;bM=a.document.createTextNode("");bN=bK.appendChild(bM);_7.RunBefore(bM,bL);};_7.RunAfterById=function(bK,bL){var bM;bM=r.Doc().getElementById(bK);bz.Equals(bM,null)?bE.FailWith("invalid id: "+bK):_7.RunAfter(bM,bL);};_7.RunAfter=function(bK,bL){var bM,bN;bM=a.document.createTextNode("");bN=bK.parentNode.insertBefore(bM,bK.nextSibling);_7.RunBetween(bK,bM,bL);};_7.RunBeforeById=function(bK,bL){var bM;bM=r.Doc().getElementById(bK);bz.Equals(bM,null)?bE.FailWith("invalid id: "+bK):_7.RunBefore(bM,bL);};_7.RunBefore=function(bK,bL){var bM,bN;bM=a.document.createTextNode("");bN=bK.parentNode.insertBefore(bM,bK);_7.RunBetween(bM,bK,bL);};_7.RunBetween=function(bK,bL,bM){var bN,bO,bP;_6.LinkPrevElement(bL,bM.docNode);bN=_6.CreateDelimitedRunState(bK,bL,bM.docNode);bO=m.StartProcessor(_6.PerformAnimatedUpdate(bN,bM.docNode));bP=bM.updates;x.Sink(bO,bP);};_7.Async=function(bK){var bL;return _7.EmbedView((bL=a.id,function(bM){return x.MapAsync(bL,bM);}(x.Const(bK))));};_7.BindView=function(bK,bL){return _7.EmbedView(x.Map(bK,bL));};_7.EmbedView=function(bK){var bL,bM,bN,bO;bL=_6.CreateEmbedNode();bM={$:2,$0:bL};return function(bP){return _7.Mk(bM,bP);}((bN=function(){},function(bP){return x.Map(bN,bP);}((bO=function(bP){_6.UpdateEmbedNode(bL,bP.docNode);return bP.updates;},function(bP){return x.Bind(bO,bP);}(bK)))));};_7.Static=function(bK){var bL,bM;bL=X.EmptyAttr();bM=_7.Empty();return _8.New(bK,bL,bM);};_7.Mk=function(bK,bL){return new _7.New(bK,bL);};_7.New=by.Ctor(function(bK,bL){this.docNode=bK;this.updates=bL;},_7);_8=d.Elt=by.Class({AddClass:function(bK){return this.elt.className+=" "+bK;},SetStyle:function(bK,bL){this.elt.style[bK]=bL;},HasClass:function(bK){return(new a.RegExp("(\\s|^)"+bK+"(\\s|$)")).test(this.elt.className);},RemoveClass:function(bK){this.elt.className=this.elt.className.replace(new a.RegExp("(?:(\\s|^)"+bK+")+(\\s|$)","g"),"$1");},GetProperty:function(bK){return this.elt[bK];},SetProperty:function(bK,bL){this.elt[bK]=bL;},RemoveAttribute:function(bK){this.elt.removeAttribute(bK);},HasAttribute:function(bK){return this.elt.hasAttribute(bK);},GetAttribute:function(bK){return this.elt.getAttribute(bK);},SetAttribute:function(bK,bL){this.elt.setAttribute(bK,bL);},SetText:function(bK){var bL,bM,bN,bO;bL=this.docNode$1;bL.$==1?bL.$0.Children={$:3}:bL.$==6?(bM=bL.$0,bM.Els=[],bM.Holes=[]):bE.FailWith("Invalid docNode in Elt");bN=this.rvUpdates;bO=x.Const();w.Set(bN,bO);this.elt.textContent=bK;},GetText:function(){return this.elt.textContent;},SetValue:function(bK){this.elt.value=bK;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var bK,bL,bM,bN,bO;bK=this.docNode$1;bK.$==1?bK.$0.Children={$:3}:bK.$==6?(bL=bK.$0,(bL.Els=[],bL.Holes=[])):bE.FailWith("Invalid docNode in Elt");bM=this.rvUpdates;bN=x.Const();w.Set(bM,bN);while(this.elt.hasChildNodes()){bO=this.elt.removeChild(this.elt.firstChild);}},Prepend:function(bK){var bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY;bL=this.docNode$1;bL.$==1?(bM=bL.$0,bM.Children={$:0,$0:bK.docNode,$1:bM.Children},bN=(bO=this.elt.firstChild,bz.Equals(bO,null)?null:bO),bP=_6.InsertDoc(this.elt,bK.docNode,bN)):bL.$==6?(bQ=bL.$0,bR=this.elt.insertBefore(a.document.createTextNode(""),this.elt.firstChild),bS=_6.InsertBeforeDelim(bR,bK.docNode),bT=bQ.Holes.push((bU=this.elt,_1.New(X.Empty(this.elt),bK.docNode,{$:1,$0:[bS,bR]},bU,h.Int(),null)))):bE.FailWith("Invalid docNode in Elt");bV=this.rvUpdates;bW=(bX=this.rvUpdates.c,(bY=bK.updates,x.Map2Unit(bX,bY)));w.Set(bV,bW);},Append:function(bK){var bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW;bL=this.docNode$1;bL.$==1?(bM=bL.$0,bM.Children={$:0,$0:bM.Children,$1:bK.docNode},bN=_6.InsertDoc(this.elt,bK.docNode,null)):bL.$==6?(bO=bL.$0,bP=this.elt.appendChild(a.document.createTextNode("")),bQ=_6.InsertBeforeDelim(bP,bK.docNode),bR=bO.Holes.push((bS=this.elt,_1.New(X.Empty(this.elt),bK.docNode,{$:1,$0:[bQ,bP]},bS,h.Int(),null)))):bE.FailWith("Invalid docNode in Elt");bT=this.rvUpdates;bU=(bV=this.rvUpdates.c,(bW=bK.updates,x.Map2Unit(bV,bW)));w.Set(bT,bU);},ToUpdater:function(){var bK,bL,bM,bN,bO;bK=(bL=this.docNode$1,bL.$==1?(bM=bL.$0,(bN=[this.elt],by.DeleteEmptyFields({Els:bN,Dirty:true,Holes:[bM],Attrs:[],Render:(bO=null,bO?bO.$0:void 0)},["Render"]))):bL.$==6?bL.$0:bE.FailWith("Invalid docNode in Elt"));return new _9.New(bK,this.updates$1,this.elt,this.rvUpdates,w.Create$1([]));},OnAfterRenderView:function(bK,bL){var bM,bN;bM=this;bN=h.Id();this.Append(_7.BindView(function(bO){bM.elt[bN]=bO;return _7.Empty();},bK));return this.OnAfterRender(function(bO){bL(bO,bO[bN]);});},OnAfterRender:function(bK){var bL,bM,bN,bO,bP,bQ,bR;bL=this.docNode$1;bL.$==1?(bM=bL.$0,by.SetOptional(bM,"Render",(bN=by.GetOptional(bM.Render),(bN!=null?bN.$==1:false)?(bO=bN.$0,{$:1,$0:function(bS){bO(bS);bK(bS);}}):{$:1,$0:bK}))):bL.$==6?(bP=bL.$0,by.SetOptional(bP,"Render",(bQ=by.GetOptional(bP.Render),(bQ!=null?bQ.$==1:false)?(bR=bQ.$0,{$:1,$0:function(bS){bR(bS);bK(bS);}}):{$:1,$0:bK}))):bE.FailWith("Invalid docNode in Elt");return this;},onView:function(bK,bL,bM){var bN;bN=bM(this.elt);this.elt.addEventListener(bK,function(bO){var bP;bP=bN(bO);return x.Get(bP,bL);},false);return this;},on:function(bK,bL){this.elt.addEventListener(bK,function(bM){return bL(bM.target,bM);},false);return this;}},_7,_8);_8.TreeNode=function(bK,bL){var bM,bN,bO,bP,bQ,bR,bS,bT;bM=w.Create$1(bL);bN=(bO=(bP=(bQ=function(bU){return bU[1];},function(bU){return X.Updates(bQ(bU));}),function(bU){return bq.map(bP,bU);}(bK.Attrs)),(bR=x.Const(),e.TreeReduce(bR,x.Map2Unit,bO)));bS=(bT=bM.v,x.Bind(function(bU){return x.Map2Unit(bN,bU);},bT));return new _8.New$1({$:6,$0:bK},bS,bq.get(bK.Els,0),bM);};_8.New=function(bK,bL,bM){var bN,bO,bP,bQ,bR;bN=_6.CreateElemNode(bK,bL,bM.docNode);bO=w.Create$1(bM.updates);bP=X.Updates(bN.Attr);bQ=(bR=bO.v,x.Bind(function(bS){return x.Map2Unit(bP,bS);},bR));return new _8.New$1({$:1,$0:bN},bQ,bK,bO);};_8.New$1=by.Ctor(function(bK,bL,bM,bN){_7.New.call(this,bK,bL);this.docNode$1=bK;this.updates$1=bL;this.elt=bM;this.rvUpdates=bN;},_8);_9=U.EltUpdater=by.Class({RemoveAllUpdated:function(){var bK;this.treeNode.Holes=[];bK=this.holeUpdates;w.Set(bK,[]);},RemoveUpdated:function(bK){var bL,bM,bN,bO,bP,bQ,bR;bL=bK.docNode;bL.$==1?(bM=bL.$0,bN=bM.ElKey,this.treeNode.Holes=(bO=function(bS){return bS.ElKey!==bN;},function(bS){return bq.filter(bO,bS);}(this.treeNode.Holes)),bP=this.holeUpdates,bQ=(bR=function(bS){return bS===bN?false:true;},function(bS){return bq.filter(function(bT){return bR(bT[0]);},bS);}(this.holeUpdates.c)),w.Set(bP,bQ)):bE.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(bK){var bL,bM,bN,bO,bP,bQ;bL=bK.docNode;bL.$==1?(bM=bL.$0,bN=this.treeNode.Holes.push(bM),bO=this.holeUpdates.c,bP=bO.push([bM.ElKey,bK.updates]),bQ=this.holeUpdates,w.Set(bQ,bO)):bE.FailWith("DocUpdater.AddUpdated expects a single element node");}},_8,_9);_9.New=by.Ctor(function(bK,bL,bM,bN,bO){var bP,bQ,bR,bS,bT,bU,bV;_8.New$1.call(this,{$:6,$0:bK},(bP=(bQ=bO.v,(bR=(bS=(bT=function(bW){return bW[1];},function(bW){return bq.map(bT,bW);}),(bU=(bV=x.Const(),function(bW){return e.TreeReduce(bV,x.Map2Unit,bW);}),function(bW){return bU(bS(bW));})),x.BindInner(bR,bQ))),x.Map2Unit(bL,bP)),bM,bN);this.treeNode=bK;this.holeUpdates=bO;},_9);_.$cctor=by.Cctor(function(){_.LoadedTemplates=new bH.New$5();_.TextHoleRE="\\${([^}]+)}";_.$cctor=a.ignore;});$=d.Flow=by.Class({get_Render:function(){return this.render;}},null,$);$.New=by.Ctor(function(bK){$.New$1.call(this,function(bL){return function(bM){var bN;bN=bK(bM);return w.Set(bL,bN);};});},$);$.New$1=by.Ctor(function(bK){this.render=bK;},$);$.get_Do=function(){return new ba.New();};$.Static=function(bK){return new $.New$1(function(bL){return function(bM){w.Set(bL,bK);return bM();};});};$.Define=function(bK){return new $.New(function(bL){return bK(function(bM){bL(bM);});});};$.Embed=function(bK){var bL;bL=w.Create$1(_7.Empty());((bK.get_Render())(bL))(function(bM){});return _7.EmbedView(bL.v);};$.Return=function(bK){return new $.New$1(function(){return function(bL){return bL(bK);};});};$.Bind=function(bK,bL){return new $.New$1(function(bM){return function(bN){return((bK.get_Render())(bM))(function(bO){((bL(bO).get_Render())(bM))(bN);});};});};$.Map=function(bK,bL){return new $.New$1(function(bM){return function(bN){return((bL.get_Render())(bM))(function(bO){bN(bK(bO));});};});};ba=d.FlowBuilder=by.Class({ReturnFrom:a.id,Return:function(bK){return $.Return(bK);},Bind:function(bK,bL){return $.Bind(bK,bL);}},null,ba);ba.New=by.Ctor(function(){},ba);bc=bb.attr=by.Class({},null,bc);bc.New=by.Ctor(function(){},bc);bd.Append=function(bK,bL){var bM,bN,bO,bP;bM=bK.$1;bN=bK.$0;bO=bL.$1;bP=bL.$0;return{$:0,$0:p.Append(bN,bP),$1:bB.FoldBack(function(bQ,bR,bS){return bS.Add(bQ,bR);},bM,bO)};};bd.FromList=function(bK,bL){return{$:0,$0:p.FromArray(bq.ofList(bK)),$1:bL};};bd.ToList=function(bK){var bL,bM;bL=bK.$0;bM=bK.$1;return[bp.ofArray(p.ToArray(bL)),bM];};bd.SameHash=function(bK,bL){return bd.NoHash(bK)===bd.NoHash(bL);};bd.MakeHash=function(bK){var bL,bM,bN,bO,bP,bQ,bR;bL=bK.$1;bM=bK.$0;bN=(bO=(bP=p.ToArray(bM),bq.map(function(bS){return a.encodeURIComponent(bS);},bP)),bs.concat("/",bO));return bL.get_IsEmpty()?bN:bN+"?"+(bQ=(bR=function(bS){var bT,bU,bV;bT=bE.KeyValue(bS);bU=bT[1];bV=bT[0];return a.encodeURIComponent(bV)+"="+a.encodeURIComponent(bU);},function(bS){return bw.map(bR,bS);}(bL)),bs.concat("&",bQ));};bd.ParseHash=function(bK){var bL,bM,bN,bO,bP,bQ,bR,bS;bL=bd.NoHash(bK);bM=(bN=bL.indexOf(a.String.fromCharCode(63)),bN===-1?[bL,""]:[bJ.string(bL,null,{$:1,$0:bN-1}),bJ.string(bL,{$:1,$0:bN+1},null)]);bO=bM[1];bP=bM[0];bQ=p.FromArray(bP===""?[]:(bR=bs.SplitChars(bP,[47],0),bq.map(function(bT){return a.decodeURIComponent(bT);},bR)));return{$:0,$0:bQ,$1:bB.OfArray((bS=function(bT){var bU,bV,bW;bU=bT.indexOf(a.String.fromCharCode(61));return bU===-1?[a.decodeURIComponent(bT),""]:[(bV=bJ.string(bT,null,{$:1,$0:bU-1}),a.decodeURIComponent(bV)),(bW=bJ.string(bT,{$:1,$0:bU+1},null),a.decodeURIComponent(bW))];},function(bT){return bq.map(bS,bT);}(bs.SplitChars(bO,[38],0))))};};bd.NoHash=function(bK){return bs.StartsWith(bK,"#")?bK.substring(1):bK;};bf.New=function(bK,bL,bM,bN){return{Bodies:bK,CurrentRoute:bL,CurrentSite:bM,Selection:bN};};be.Install=function(bK,bL){var bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX;function bY(bZ){var b0,b1,b2,b3;b0=bS(bZ);b0.$==1?void 0:(b1=b0.$0,b2=b0.$1,b3=bd.FromList(b2,new bC.New([])),be.OnGlobalRouteChange(bP,b1,b3));}bM=bL.$0;bN=bL.$1;bO=be.InstallMap({Des:function(bZ){var b0,b1;b0=bZ[0];b1=bZ[1];return bd.FromList(b0,b1);},Ser:bd.ToList});bP=bf.New(void 0,bO,0,void 0);bQ=(bR=function(bZ,b0){var b1,b2;b1=b0.$1;b2=b0.$0;return b1({UpdateRoute:function(b3){be.OnInternalSiteUpdate(bP,b2,bZ,b3);}});},function(bZ){return t.Map(function(b0){return function(b1){return bR(b0,b1);};},bZ);}(bN));bP.Bodies=be.ComputeBodies(bQ);bS=function(bZ){var b0,b1;b0=bd.ToList(bZ);b1=b0[0];return t.Lookup(bQ,b1);};bT=(bU=bS(bO.c),bU.$==0?(bV=bU.$0,(bP.CurrentSite=bV.RouteId,w.Create$1(bV.RouteValue))):w.Create$1((bM!=null?bM.$==1:false)?bM.$0:bE.FailWith("Site.Install fails on empty site")));bP.Selection=bT;bW=function(bZ){be.OnSelectSite(bP,bK(bZ));};(function(bZ){x.Sink(bW,bZ);}(bT.v));bY(bO.c);bX=bO.v;x.Sink(bY,bX);return bT;};be.OnSelectSite=function(bK,bL){var bM;bM=bL.$0;bK.CurrentSite!==bM?(bK.CurrentSite=bM,bK.Bodies.get_Item(bM).OnSelect()):void 0;};be.OnInternalSiteUpdate=function(bK,bL,bM,bN){var bO;if(bK.CurrentSite===bL){bO=bd.Append(bd.FromList(bM,new bC.New([])),bN);be.SetCurrentRoute(bK,bO);}};be.OnGlobalRouteChange=function(bK,bL,bM){var bN,bO;bK.CurrentSite!==bL.RouteId?(bK.CurrentSite=bL.RouteId,bN=bK.Selection,bO=bL.RouteValue,w.Set(bN,bO)):void 0;bL.OnRouteChanged(bM);};be.SetCurrentRoute=function(bK,bL){var bM;if(!bz.Equals(bK.CurrentRoute.c,bL)){bM=bK.CurrentRoute;w.Set(bM,bL);}};be.ComputeBodies=function(bK){var bL,bM;bL=new bH.New$5();bM=function(bN){bL.set_Item(bN.RouteId,bN);};(function(bN){bq.iter(bM,bN);}(t.ToArray(bK)));return bL;};be.MergeRouters=function(bK){var bL,bM,bN,bO,bP;bL=e.ofSeqNonCopying(bK);bM=t.Merge((bN=function(bQ){return bQ.$1;},function(bQ){return bw.map(bN,bQ);}(bL)));bO=(bP=function(bQ){return bQ.$0;},function(bQ){return bw.tryPick(bP,bQ);}(bL));return(bM!=null?bM.$==1:false)?{$:0,$0:bO,$1:bM.$0}:bE.FailWith("Invalid Site.Merge: need more prefix disambiguation");};be.DefineRoute=function(bK,bL,bM){var bN,bO,bP;bN=w.Create$1(bL);bO=h.Int();bP=bM({$:0,$0:bO},bN);return{$:0,$0:{$:1,$0:bP},$1:t.Leaf({$:0,$0:bO,$1:function(bQ){var bR;bR=function(bS){bQ.UpdateRoute(be.DoLink(bK,bS));};(function(bS){x.Sink(bR,bS);}(bN.v));return{OnRouteChanged:function(bS){var bT;bT=be.DoRoute(bK,bS);w.Set(bN,bT);},OnSelect:function(){bQ.UpdateRoute(be.DoLink(bK,bN.c));},RouteId:bO,RouteValue:bP};}})};};be.DoLink=function(bK,bL){var bM,bN,bO;bM=bK.Ser(bL);bN=bM[0];bO=bM[1];return bd.FromList(bN,bO);};be.DoRoute=function(bK,bL){return bK.Des(bd.ToList(bL));};be.InstallMap=function(bK){var bL,bM,bN,bO,bP,bQ;function bR(bS){return bP(bN());}bL=a.window;bM=function(bS,bT){return bz.Equals(bK.Ser(bS),bK.Ser(bT));};bN=function(){return bK.Des(bd.ToList(bd.ParseHash(bL.location.hash)));};bO=w.Create$1(bN());bP=function(bS){if(!bM(bO.c,bS))w.Set(bO,bS);};bL.onpopstate=bR;bL.onhashchange=bR;bQ=function(bS){var bT,bU,bV,bW;bT=bd.MakeHash((bU=bK.Ser(bS),(bV=bU[0],(bW=bU[1],bd.FromList(bV,bW)))));!bd.SameHash(bL.location.hash,bT)?bL.location.replace("#"+bT):void 0;};(function(bS){x.Sink(bQ,bS);}(bO.v));return bO;};bg.Install=function(bK){return be.InstallMap(bK);};bg.Create=function(bK,bL){var bM;return{Des:(bM=function(bN){return bN[0];},function(bN){return bL(bM(bN));}),Ser:function(bN){return[bK(bN),new bC.New([])];}};};bg.CreateWithQuery=function(bK,bL){return{Des:bL,Ser:bK};};bh.Route=function(bK,bL,bM){return be.DefineRoute(bK,bL,bM);};bh.Prefix=function(bK,bL){var bM,bN;bM=bL.$0;bN=bL.$1;return{$:0,$0:bM,$1:t.Prefix(bK,bN)};};bh.Merge=function(bK){return be.MergeRouters(bK);};bh.Install=function(bK,bL){return be.Install(bK,bL);};bh.Dir=function(bK,bL){var bM;bM=bh.Merge(bL);return bh.Prefix(bK,bM);};bj.New=function(bK,bL){return{Active:bK,PosV:bL};};bk.New=function(bK,bL,bM,bN){return{Active:bK,Left:bL,Middle:bM,Right:bN};};bl.get_MousePressed=function(){var bK,bL,bM,bN,bO,bP;bi.ActivateButtonListener();bK=(bL=(bM=x.Const(by.Curried3(function(bQ,bR,bS){return(bQ?true:bR)?true:bS;})),(bN=bi.MouseBtnSt$1().Left.v,x.Apply(bM,bN))),(bO=bi.MouseBtnSt$1().Middle.v,x.Apply(bL,bO)));bP=bi.MouseBtnSt$1().Right.v;return x.Apply(bK,bP);};bl.get_RightPressed=function(){bi.ActivateButtonListener();return bi.MouseBtnSt$1().Right.v;};bl.get_MiddlePressed=function(){bi.ActivateButtonListener();return bi.MouseBtnSt$1().Middle.v;};bl.get_LeftPressed=function(){bi.ActivateButtonListener();return bi.MouseBtnSt$1().Left.v;};bl.get_Position=function(){!bi.MousePosSt$1().Active?(a.document.addEventListener("mousemove",function(bK){var bL,bM;bL=bi.MousePosSt$1().PosV;bM=[bK.clientX,bK.clientY];w.Set(bL,bM);},false),bi.MousePosSt$1().Active=true):void 0;return bi.MousePosSt$1().PosV.v;};bm.New=function(bK,bL,bM){return{KeysPressed:bK,KeyListenerActive:bL,LastPressed:bM};};bn.IsPressed=function(bK){var bL,bM;bi.ActivateKeyListener();bL=bi.KeyListenerState().KeysPressed.v;return x.Map((bM=function(bN){return bN===bK;},function(bN){return bp.exists(bM,bN);}),bL);};bn.get_LastPressed=function(){bi.ActivateKeyListener();return bi.KeyListenerState().LastPressed.v;};bn.get_KeysPressed=function(){bi.ActivateKeyListener();return bi.KeyListenerState().KeysPressed.v;};bi.ActivateKeyListener=function(){bo.$cctor();return bo.ActivateKeyListener;};bi.KeyListenerState=function(){bo.$cctor();return bo.KeyListenerState;};bi.ActivateButtonListener=function(){bo.$cctor();return bo.ActivateButtonListener;};bi.MouseBtnSt$1=function(){bo.$cctor();return bo.MouseBtnSt;};bi.MousePosSt$1=function(){bo.$cctor();return bo.MousePosSt;};bo.$cctor=by.Cctor(function(){var bK,bL,bM,bN,bO,bP,bQ,bR,bS;bo.MousePosSt=bj.New(false,w.Create$1([0,0]));bo.MouseBtnSt=bk.New(false,w.Create$1(false),w.Create$1(false),w.Create$1(false));bo.ActivateButtonListener=(bK=function(bT,bU){var bV,bW,bX,bY;bV=bT.button;return bV===0?(bW=bi.MouseBtnSt$1().Left,w.Set(bW,bU)):bV===1?(bX=bi.MouseBtnSt$1().Middle,w.Set(bX,bU)):bV===2?(bY=bi.MouseBtnSt$1().Right,w.Set(bY,bU)):null;},!bi.MouseBtnSt$1().Active?(bi.MouseBtnSt$1().Active=true,a.document.addEventListener("mousedown",function(bT){return bK(bT,true);},false),a.document.addEventListener("mouseup",function(bT){return bK(bT,false);},false)):null);bo.KeyListenerState=bm.New(w.Create$1(new bp.T({$:0})),false,w.Create$1(-1));bo.ActivateKeyListener=!bi.KeyListenerState().KeyListenerActive?(bL=(bM=(bN=a.document,a.jQuery(bN)),(bO=function(bT,bU){var bV,bW,bX,bY,bZ;bV=bU.which;bW=bi.KeyListenerState().LastPressed;w.Set(bW,bV);bX=bi.KeyListenerState().KeysPressed.c;return!bp.exists(function(b0){return b0===bV;},bX)?(bY=bi.KeyListenerState().KeysPressed,(bZ=bp.append(bX,bp.ofArray([bV])),w.Set(bY,bZ))):null;},bM.keydown(function(bT){return bO(this,bT);}))),bP=(bQ=(bR=a.document,a.jQuery(bR)),(bS=function(bT,bU){var bV,bW,bX;bV=bU.which;bW=bi.KeyListenerState().KeysPressed;return w.Update(bW,(bX=function(bY){return bY!==bV;},function(bY){return bp.filter(bX,bY);}));},bQ.keyup(function(bT){return bS(this,bT);})))):null;bo.$cctor=a.ignore;});}());
